{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/config/lab.js","webpack:///./src/arcgis-map-ipywidget/loaders/get-esri-loader.js","webpack:///external \"@jupyter-widgets/base\"","webpack:///./src/arcgis-map-ipywidget/images/images.js","webpack:///external \"lodash\"","webpack:///./src/arcgis-map-ipywidget/elements/loading-progress-display.js","webpack:///./src/config/configure-cdn.js","webpack:///./src/arcgis-map-ipywidget/renderer-utils/renderer-types-util.js","webpack:///./src/labplugin.ts","webpack:///./src/arcgis-map-ipywidget/arcgis-map-ipywidget.js","webpack:///./src/arcgis-map-ipywidget/arcgis-map-ipywidget-model.js","webpack:///./src/arcgis-map-ipywidget/arcgis-map-ipywidget-view.js","webpack:///./src/arcgis-map-ipywidget/elements/create-elements.js","webpack:///./src/config/common.js","webpack:///./src/arcgis-map-ipywidget/elements/display-purejs-error-box.js","webpack:///./src/arcgis-map-ipywidget/layer-utils/infer-no-type-layer.js","webpack:///external \"esri-loader\"","webpack:///./src/arcgis-map-ipywidget/loaders/requirejs-esri-loader.ts","webpack:///./src/arcgis-map-ipywidget/renderer-utils/infer-renderer.js","webpack:///./src/arcgis-map-ipywidget/popup-utils/create-default-popup.js","webpack:///./src/arcgis-map-ipywidget/layer-utils/get-image-overlay-layer-type.js","webpack:///./src/css/main.css?8788","webpack:///./src/css/main.css","webpack:///./node_modules/css-loader/lib/css-base.js","webpack:///external \"@lumino/widgets\"","webpack:///external \"@jupyterlab/apputils\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","config","configureCdn","JSOutputContext","JupyterTarget","CdnUrl","defaultEsriLoader","requireJSEsriLoader","__WEBPACK_EXTERNAL_MODULE__2__","sceneToMapEncoded","mapToSceneEncoded","toNewWindowEncoded","toOriginalWindowEncoded","screenshotErrorEncoded","require","cyclingCount","intervalIds","element","document","createElement","id","style","textAlign","verticalAlign","intervalCallback","textContent","start","length","push","setInterval","stop","pop","clearInterval","cdn","EsriLoaderOptions","url","BaseRequireJSConfig","packages","location","main","window","customRequire","scriptEl","querySelector","parentNode","removeChild","isClassedSizeRenderer","renderer","test","isClassedColorRenderer","isSmartMapRenderer","isHeatMapRenderer","isClassBreaksRenderer","isSimpleRenderer","isUniqueRenderer","isDotDensityRenderer","userSpecifiedAutocastRenderer","title","ipywidgetElement","originalParentElement","parentElement","node","appendChild","Math","random","toString","substring","label","closable","addClass","restoreToOriginalParentElement","msg","this","hasChildNodes","lastChild","mapForAllChildrenOfIPyWidgetElement","childNode","src","height","prevElementHeight","func","recursiveChildDescend","childElementCount","child","childNodes","Widget","extension","autoStart","requires","ICommandPalette","IJupyterWidgetRegistry","activate","app","palette","widgets","commands","shell","registerWidget","version","ArcGISMapIPyWidgetModel","ArcGISMapIPyWidgetView","addCommand","caption","execute","args","console","log","ipyExtWinCon","IPythonExtensionWidgetContainer","activateById","tab_mode","autoPlaceInMainArea","add","alert","addItem","command","category","newJLabWindow","phosphorWidgets","getAllPhosphorWidgets","j","pwidget","k","children","close","closeJLabWindow","numPhosphorWidgetsInMain","next","numActiveWindows","_currentTabBar","titles","err","outputWidgets","areas","area","widget","_","DOMWidgetModel","extend","defaults","_model_name","_view_name","_model_module","_view_module","_model_module_version","_view_module_version","_basemap","_gallery_basemaps","_zoom","_readonly_zoom","_scale","_snap_to_zoom","_readonly_scale","_rotation","_readonly_rotation","_link_writeonly_rotation","_heading","_readonly_heading","_link_writeonly_heading","_tilt","_readonly_tilt","_link_writeonly_tilt","_extent","_readonly_extent","_link_writeonly_extent","_center","_readonly_center","_center_long_lat","_func_chains","_add_this_notype_layer","_readonly_notype_layers","_draw_these_notype_layers_on_widget_load","_layers_to_remove","_add_this_graphic","_draw_these_graphics_on_widget_load","_webmap","_webscene","_trigger_webscene_save_to_this_portal_id","_readonly_webmap_from_js","_preview_screenshot_callback_resp","_cell_output_screenshot_callback_resp","_file_output_screenshot_callback_resp","_trigger_screenshot_with_args","_overlay_this_image","_overlay_these_images_on_widget_load","_image_overlays_to_remove","time_slider","time_mode","_time_info","_writeonly_start_time","_readonly_start_time","_writeonly_end_time","_readonly_end_time","_portal_token","_auth_mode","_portal_url","_portal_sharing_rest_url","_username","_custom_msg","hide_mode_switch","_trigger_interactive_draw_mode_for","_trigger_new_jlab_window_with_args","jupyter_target","ready","_js_cdn_override","legend","_uuid","_trigger_print_js_debug_info","createElements","displayPureJSErrorBox","loadingProgressDisplay","inferNoTypeLayer","getImageOverlayLayerType","images","mainCssString","configureCDN","esriLoader","getEsriLoader","options","cssString","innerHTML","head","link","rel","href","_applyCssFromUrl","CdnMainCssUrl","globalTokenLookup","DOMWidgetView","render","_override_right_click_menu","_setup_js_cdn","_setup_elements","model","set","loadModules","then","Map","MapView","WebMap","WebScene","SceneView","watchUtils","Compass","Legend","TimeSlider","_setup_custom_buttons","_instantiate_esri_components","_miscellanous_setup","on","mode_changed","basemap_changed","zoom_changed","scale_changed","snap_to_zoom_changed","rotation_changed","link_rotation_changed","heading_changed","link_heading_changed","tilt_changed","link_tilt_changed","extent_changed","link_extent_changed","center_changed","center_long_lat_changed","func_chains_changed","add_this_notype_layer_changed","layers_to_remove_changed","graphics_changed","webmap_changed","webscene_changed","save_webscene","_trigger_screenshot_with_args_changed","overlay_image_changed","image_overlays_to_remove_changed","time_slider_prop_changed","time_mode_changed","time_info_changed","start_time_changed","end_time_changed","portal_token_changed","custom_msg_changed","hide_mode_switch_changed","interactive_draw_shape","trigger_jlab_window_changed","js_cdn_changed","legend_prop_changed","trigger_print_js_debug_info_changed","update_widget_from_model","_postLoadSetup","catch","_displayErrorBox","warn","Promise","resolve","reject","authenticate_to_portal","draw_these_notype_layers_on_widget_load","draw_these_graphics_on_widget_load","overlay_these_images_on_widget_load","browser_console_message","getElementById","elements","errorTextBox","el","multiple_messages_info","uuid","className","width","viewdivElement","infodivElement","switchButton","onclick","touch","newWindowButton","move_to_new_jlab_window","_setup_2d_stationary_callback","_MapView","_pointerMoveHandler","event","when","_2dStationaryCallback","remove","_setup_3d_stationary_callback","_SceneView","_3dStationaryCallback","widget_inst","_parentIPyWidget","rotation","heading","apply_heading_to_view","_commonStationaryCallback","camera","apply_rotation_to_view","tilt","zoom","activeView","scale","center","JSON","parse","stringify","extent","save_changes","map","allLayers","update_readonly_webmap","event_","send","message","mapPoint","_hidePreviewEls","_set_screenshot_keyboard_shortcut","cssEl","type","container","mapElement","toLowerCase","ground","ui","view","_time_slider","watch","values","time_slider_values_changed","_legend","layerInfos","addEventListener","e","preventDefault","stopPropagation","shiftKey","_get_uuidv4","replace","Basemap","basemapStr","galleryBasemaps","basemapJSON","basemap","fromJSON","viewpoint","clone","layers","snapToZoom","constraints","_applyHeading","goTo","animate","once","apply_tilt_to_view","_applyTilt","apply_extent_to_view","Extent","SpatialReference","projection","xmin","load","project","WebMercator","view_center","webmap_from_python","keys","layers_json","toArray","layer","layer_json","normalization","refreshInterval","graphics","graphic","graphic_json","toJSON","shape","rendererType","declaredClass","wm","ViewPoint","InitialViewProperties","webscene_from_python","portal","portalItem","webscene","Ground","scene","portal_item_id","updateFrom","save","ignoreUnsupported","item","reload_all_layers","noTypeLayer","add_notype_layer","layersToInfer","layerToInfer","typedLayer","_hashFromPython","layerId","findLayerById","layerExistsOnMap","Boolean","getGraphicsLayer","GraphicsLayer","graphicsLayer","add_graphic","Graphic","Geometry","symbolJsonUtils","gfx","symbol","geometry","SketchViewModel","sketch","state","childMapElement","window_title","activeMapElement","_portalToken","get_portal_token","esriConfig","ServerInfo","IdentityManager","Portal","_portal","portalUrl","authMode","serverInfo","server","tokenServiceUrl","registerServers","registerToken","request","trustedServers","rejMsg","allSSL","canSignInArcGIS","canSignInIDP","authorizedCrossOriginDomains","fallback_cdn","_check_js_api_version_loaded","css_url","setRequireJSConfig","$","append","attr","loadCss","corsEnabledServers","empty","timeMode","toISOString","TimeExtent","TimeInterval","timeInfo","Date","time_extent","end","fullTimeExtent","intervalValue","intervalUnit","interval","unit","stops","startTimeStr","startTime","endTime","endTimeStr","modelStrsToSendTo","set_as_preview","output_in_cell","file_path","_capture_screenshot_send_to","funcToCall","_get_3d_screenshot","_get_2d_screenshot","base64Str","modelStr","takeScreenshot","format","screenshot","dataUrl","image","overlay_this_image","getActiveImageOverlayLayer","ImageOverlayLayer","imageOverlayLayer","nbPath","widget_manager","context","session","path","nbName","nbDir","lastIndexOf","tryOverlayImage","includes","status","overlaysToRemove","tryRemoveImageOverlays","_httpGetAsync","response","lines","split","copyrightLine","line","indexOf","versionNum","minJSAPIVersion","theUrl","fetch","text","data","loadingProgress","padding","margin","position","top","left","classList","boxShadow","border","float","marginRight","fontFamily","fontSize","loadingText","right","color","backgroundColor","fontWeight","wordWrap","errorCloseButton","clearAllText","dojoConfig","has","inferRenderer","rendererTypesUtil","createDefaultPopup","ImageryLayer","KMLLayer","TileLayer","MapImageLayer","VectorTileLayer","SceneLayer","FeatureLayer","FeatureSet","WMSLayer","WMTSLayer","GeoRSSLayer","GeoJSONLayer","CSVLayer","RasterFunction","MosaicRule","PointCloudLayer","IntegratedMeshLayer","BuildingSceneLayer","ImageryTileLayer","capabilities","imageServiceParameters","renderingRuleJSON","renderingRule","mosaicRuleJSON","mosaicRule","encodedRaster","raster","btoa","subLayers","sublayers","blob","Blob","URL","createObjectURL","layerDefinition","drawingInfo","unloadedLayer","popupTemplate","lyr_options","opacity","definition_expression","definitionExpression","rendererOptions","fieldName","field_name","otherLayerOptions","esriJSONFS","featureSet","spatialReference","fields","objectIdField","geometryType","source","features","getCss","createStylesheetLink","isBrowser","handleScriptLoad","script","callback","errback","onScriptError","error","Error","removeEventListener","handleScriptError","onScriptLoad","getScript","isLoaded","loadScript","utils","getAttribute","css","requirejsConfig","setAttribute","createScript","body","loadScriptOptions","requireModules","undefined","getColorOrSizeProp","assign","field","classificationMethod","otherLyrOptions","sizeRendererCreator","colorRendererCreator","locationRendererCreator","SimpleRenderer","UniqueValueRenderer","ClassBreaksRenderer","HeatmapRenderer","DotDensityRenderer","prop","createClassBreaksRenderer","fieldInfos","alias","content","BaseLayerView2D","Collection","ImageOverlayLayerView2D","createSubclass","constructor","requestUpdate","requestRender","watcher","renderParameters","pixelRatio","size","translate","rotate","PI","_imagesToOverlay","imgToOverlay","getItemAt","min","toScreenNoRotation","ymax","max","xmax","ymin","globalAlpha","drawImage","imgEl","restore","createLayerView","imageOverlaysToRemove","existingOverlay","removeAt","randQuery","imageOverlaySrc","resp","BadHTTPStatusError","super","statusText","Image","onload","result","useSourceMap","list","cssMapping","sourceMapping","sourceMap","unescape","encodeURIComponent","sourceURLs","sources","sourceRoot","concat","join","cssWithMappingToString","mediaQuery","alreadyImportedModules"],"mappings":"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","file":"arcgis-map-ipywidget-jupyterlab.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","var config = require(\"./common\");\r\nvar configureCdn = require(\"./configure-cdn\");\r\n\r\nconfig.JSOutputContext = \"default\";\r\nconfig.JupyterTarget = \"lab\"; \r\nconfigureCdn(config, config.CdnUrl);\r\n\r\nmodule.exports = config;\r\n","var defaultEsriLoader = require(\"esri-loader\");\r\nvar requireJSEsriLoader = require(\"./requirejs-esri-loader\");\r\n\r\nfunction getEsriLoader(config){\r\n    if(!config.JupyterTarget){\r\n        throw \"config does not specify 'JupyterTarget'! Failing\";\r\n    } else if(config.JupyterTarget === \"lab\"){\r\n        return defaultEsriLoader;\r\n    } else if(config.JupyterTarget === \"notebook\") {\r\n        //Jupyter Notebooks use RequireJS for AMD module loading\r\n        //We must use the custom requireJSesri-loader for it to work\r\n        //See ./requirejs-esri-loader.js for more details\r\n        return requireJSEsriLoader;\r\n    } else{\r\n        throw \"Misconfigured config file! Failing\";\r\n    }\r\n}\r\n\r\nmodule.exports = getEsriLoader;\r\n","module.exports = __WEBPACK_EXTERNAL_MODULE__2__;","module.exports = { \r\n    sceneToMapEncoded: \" data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcHFAkxI5xEXwAAAuxJREFUWMPt10toXVUUBuAvpjSiYJKBxdMWiohIIahsEBKwgwwKFUrxBba2A/GBgsjGKkSpYBEHKjjYWIqiIChoW3wg1gbEF2RgrtUNSilIdSLChZY2TSFKNaFOduVyuDe5iQkqdM3OZp+1/v3/6/xrHy7Fvxw97RZDCKvxEHZhALM4g4N4I+f8x3IBuKxN8fX4DL04iQfxAe7DtdgfQli7XAB6a8X7cAQRvyDgcvyMVWXbPrxcVdXhZrM5t9wMPIw5jOFuvJRzfhGHMIqBnPMpfFiY+cexqva8q5zwo5zzdMv6IXyFmRDCID7Bp9gfYzzQJu9ISmnDUgBcgVvwJaaLLLfjhgJgLQ7gSWyAlNL2etIOoLoC0ItnsQdPhBA24m1cl3M+2dIrt2JwJSQ4V1joDSFswjU4hZnavptxfCU+w3ewG09hO97DOL4IIYyHEAbKvtHCTCvtT8cYN9XWBmKMryyGgVcxWTSezDlfwKOF9rcwG0IYKvq/Xnv3BTweY7xYfLDI+UzXPtBsNueqqhrHc+irqup4s9k8A1VV3V8ccQw7cs5Tre82Gg2NRuPr4eHhbdhaGnZvSuncUqy4D49gZ7HiafyG9/Fazvn8fEljjPfgcEpp5v85jGqnuRJbU0oHO7B1HicWSLMOU4XF63POfZ2asF78qtJIt8UYr04p7Wuz7UTOeahTjhDCA0XKO3LO0yGEY/NOw5bi/aUZn8cP+D7GuDvG2NMtvcXI7sTmmrUvDKAU3ptSmiqWO4GjxSO6jVG8m3Oe69YH/o6U0mNt1iYw0eXp1xcPuXFRF5LliBBCL7bg4/lOv2ATLrJoD3bgG3yHXzGy2GHUKUbajdjaKF5X7PhoATKJP0MIW3BXcdCzSwLQ5eViM9bg25zzkcLKGLbhxzI9V6N/RSTIOb8ZQui/mLNIcm/O+aaaTD+tZBM2sbNc6/fg8xrIC/h9JQGcLf8PsziNjeVzXPos6KL7jy1BrqFL/4T/mfgLBbP14SVdyAQAAAAASUVORK5CYII=\",\r\n    mapToSceneEncoded: \" data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcHFAg1PeqxBwAAAuBJREFUWMPt10+IlWUUBvDfNMMYBc7MproZuCgJQTIOCHcgwRaGiyirgTLdZRRY9JGBRVKWLSxQ3kVEURAklAoRorkIimBaXMzeVURhbSS4kDTOFBaag23e4HKZP99cZ6jAs3v/fed5zznv85yPq/YvW1/nICIu4PQ8Z1bgHP7AqpzzsisBMNA1Pp1zXjPb5oh4DFvxQM55KiK+vdIIDNTdGBGr8SA25pynFysF1yxg7934aDGd145ARNyCHbhjsYtwoIbzfmzCsdluX1XVoRmmR1NKK3sCEBF92IKT+AY/Y3S2j6SUHqkJqnYEVmAfvi5AWvgrIjbhIezC5FKmYCNuwKmc84kSlV24Dz/gOwxiaEkA5Jzfj4ihf9ZLSh7NOa/tStOPXWF/AV+llMY75oaxN6X09EKfYRtbI2IQL+LzLpCX8WfXmX1YV1XV+uJ8BHuwuxcemMQELuFXrC7P0RzFeDmldABry5PdjZdSSlN1tWDB1DobdVdV9TCOp5TO/3/UcDarqup63JtSOjwPaQ3icWzDcEnfBA7jvZzzxe4z/TWcL8cr2N5sNvtardbJOej6KL7HjYUrLpYivAdjjUbjVLvd/r02gKqqhvAq9mIdjjWbzbFms9lqtVqdzpfhBJ7BGQSuxU8dT/1N7G80Gsfb7fZ0XTV8DXtSSudKlY8Xdny+a98TmC63HsMbOefXcaSo6HDO+Sw+wfbaYjQTeRQQ413T28oNj+acO5/cEXyJ8xExgk/xGd7qpR+Yy64rKVrekZbNuL0Mb8YhrMLKnjqieawfLxfG3Fm6p4O4Nef8SweouzDSK4DRmSS2SPFvJQr9EbEeN+EsuknoziJkCwcwT3PxIZ4txbkfT2EDvoiICWzJOU+Wgjy4FCl4u/QMz6FVhGpHCfsHuBQRa0r+3+21KZ1LDy7g/tKsbIiI2zqWR8raAWzuZsO+xeT1QkhPln+HYUyVH5iP8U4BetX+W/Y3rHL2yx0HDBIAAAAASUVORK5CYII=\",\r\n    toNewWindowEncoded: \"  data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcUAAIIxu7mQQAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABI0lEQVRYw+1Wy3GDMBTch3JLBanA+TQR0gDz4JB0Y1xISkBAA4EqHOeYU6qAzYVkPAyWYSLii/Ymzb63q89qBAQEXBgyNamquYhs5zSw1v72SNOUp3gkd2VZ5uP5K1dzkrslqxnzRWQD4MVV4zQw5XguP8uyDckGwBeAm1M10Rrnqqq3fd+3JEVEYhc3WkMcQDMM46IoPv7NQJIkdyLS/oiXZXk4VxP5FDfGNEvEz17Cuciy7J7kGwB0XRfXdX0Yp+NoZ/waGMQbABzE35ekKfIkDhF5mhJf7Q6o6sOReFwUxd7BzdM0ffR5BALglaQAiK21eydZZEsSAFpfBkjy2Rhz7Vr5qimoqurTR4JWeYqDgWDAWwpUNb+ogbn/woCAgL/gG9knfWwKBGcvAAAAAElFTkSuQmC\",\r\n    toOriginalWindowEncoded:  \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcUAAYsnoHHlAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAABG0lEQVRYw+2WMVLDMBBF/9q+BBUlAS5hn8BeqQk1B8HcBgpLowtgnyJwGWtTkFAEOzIgkmHQLzXjeW9nV2sBKSn/PTR1yMwtET3EBInIo7W2PTwvQh9FqfJIMUcFpoy/E6XUrEB27hlIAkngxwJa65umaS7PIsDMt977gYie55ZaKMXM4hhEJFi5iLy87yu5ByDRBIwxA4AhAO93spUxZnOyFtR1fb2rHERUdV23iT6ESqmSmdspeJ7nfSz4rICIlIc/EGZe7eHjOEaBL24BM68AfMCdc6+x9kDxFbiIlM65t5MtIq311R4OoLLWRoUHBUSkJyLJsqz8DfiSFlwAePLe3zHz5ENl6rZEnQEAa6JPW7Zd8txKSfkT2QKASXQbvOVu9AAAAABJRU5ErkJggg==\",\r\n    screenshotErrorEncoded: \"data:image/png;base64,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\"}\r\n","module.exports = require(\"lodash\");","//modifies the passed in element's textContent to mimic an animation until\r\n//stop() is called\r\n\r\nvar baseText = \" Loading \";\r\nvar cyclingIcon = \"🗺️\";\r\nvar cyclingCount = 0;\r\nvar intervalIds = [];\r\nvar element = document.createElement(\"div\");\r\nelement.id = 'loadingTextDiv';\r\nelement.style.textAlign = \"center\";\r\nelement.style.verticalAlign = \"text-top\";\r\n//element.style.top = \"0%\";\r\n\r\nvar start = function(){\r\n    element.textContent = baseText;\r\n    if(intervalIds.length === 0){\r\n        intervalIds.push(setInterval(intervalCallback, 700));\r\n    }\r\n}\r\n\r\nvar intervalCallback = function(){\r\n    if (cyclingCount++ % 4 == 0){\r\n        element.textContent = baseText;\r\n    }else{\r\n        element.textContent = cyclingIcon + element.textContent + cyclingIcon;\r\n    }\r\n}\r\n\r\nvar stop = function(){\r\n    while((id=intervalIds.pop()) != null){\r\n        clearInterval(id);\r\n    }\r\n    element.textContent = \"\";\r\n}\r\n\r\nmodule.exports = { start: start,\r\n                   stop: stop,\r\n                   element: element}\r\n","var configureCDN = function(config, cdn){\r\n    ///Takes in an existing config, updates the mainCDN and fallbackCDN for\r\n    ///Jupyter notebook configuration (Jupyterlab configuration just uses\r\n    ///the main CDNUrl defined in the 'esriLoaderOptions' var of the config\r\n    config.CdnUrl = cdn;\r\n    config.EsriLoaderOptions.url = config.CdnUrl\r\n    if (config.JupyterTarget === \"notebook\"){\r\n        config.BaseRequireJSConfig.packages = \r\n           [{ name: \"esri\", location: config.CdnUrl + \"esri\" },\r\n            { name: \"dojo\", location: config.CdnUrl + \"dojo\" },\r\n            { name: \"dojox\", location: config.CdnUrl + \"dojox\" },\r\n            { name: \"dijit\", location: config.CdnUrl + \"dijit\" },\r\n            { name: \"dstore\", location: config.CdnUrl + \"dstore\" },\r\n            { name: \"moment\", location: config.CdnUrl + \"moment\" },\r\n            { name: \"@dojo\", location: config.CdnUrl + \"@dojo\" },\r\n            {\r\n              name: \"cldrjs\",\r\n              location: config.CdnUrl + \"cldrjs\",\r\n              main: \"dist/cldr\"\r\n            },\r\n            {\r\n              name: \"globalize\",\r\n              location: config.CdnUrl + \"globalize\",\r\n              main: \"dist/globalize\"\r\n            },\r\n            {\r\n              name: \"maquette\",\r\n              location: config.CdnUrl + \"maquette\",\r\n              main: \"dist/maquette.umd\"\r\n            },\r\n            {\r\n              name: \"maquette-css-transitions\",\r\n              location: config.CdnUrl + \"maquette-css-transitions\",\r\n              main: \"dist/maquette-css-transitions.umd\"\r\n            },\r\n            {\r\n              name: \"maquette-jsx\",\r\n              location: config.CdnUrl + \"maquette-jsx\",\r\n              main: \"dist/maquette-jsx.umd\"\r\n            },\r\n            { name: \"tslib\", location: config.CdnUrl + \"tslib\", main: \"tslib\" }\r\n            ]\r\n        if (window.require) {\r\n            window.customRequire = window.require.config(config.BaseRequireJSConfig);\r\n        }\r\n    } else if (config.JupyterTarget === \"lab\"){\r\n        //delete any existing script tags in a jupyterlab setting\r\n        //TODO: Find a more elegant solution to removing the original script element\r\n        var scriptEl = document.querySelector('script[data-esri-loader]');\r\n        if(scriptEl != null){\r\n            scriptEl.parentNode.removeChild(scriptEl);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = configureCDN;\r\n","var isSmartMapRenderer = function(renderer){\r\n    return isClassedSizeRenderer(renderer) ||\r\n           isClassedColorRenderer(renderer)\r\n}\r\n\r\nvar isHeatMapRenderer = function(renderer){\r\n    return /.*heat.*/i.test(renderer);\r\n}\r\n\r\nvar isClassBreaksRenderer = function(renderer){\r\n    return /.*class.*break.*/i.test(renderer);\r\n}\r\n\r\nvar isClassedSizeRenderer = function(renderer){\r\n    return /.*class.*size.*/i.test(renderer);\r\n}\r\n\r\nvar isClassedColorRenderer = function(renderer){\r\n    return /.*class.*color.*/i.test(renderer);\r\n}\r\n\r\nvar isSimpleRenderer = function(renderer){\r\n    return /.*simple.*/i.test(renderer);\r\n}\r\n\r\nvar isUniqueRenderer = function(renderer){\r\n    return /.*unique.*/i.test(renderer);\r\n}\r\n\r\nvar isDotDensityRenderer = function(renderer){\r\n    return /.*dot.*density.*/i.test(renderer);\r\n}\r\n\r\nvar userSpecifiedAutocastRenderer = function(renderer){\r\n    return /.*auto.*cast.*/i.test(renderer);\r\n}\r\n\r\nmodule.exports = { isSmartMapRenderer: isSmartMapRenderer,\r\n                   isHeatMapRenderer: isHeatMapRenderer,\r\n                   isClassedColorRenderer: isClassedColorRenderer,\r\n                   isClassBreaksRenderer: isClassBreaksRenderer,\r\n                   isClassedSizeRenderer: isClassedSizeRenderer,\r\n                   isSimpleRenderer: isSimpleRenderer,\r\n                   isUniqueRenderer: isUniqueRenderer,\r\n                   isDotDensityRenderer: isDotDensityRenderer,\r\n                   userSpecifiedAutocastRenderer: userSpecifiedAutocastRenderer,};\r\n","import { IJupyterWidgetRegistry} from '@jupyter-widgets/base';\r\nimport { ArcGISMapIPyWidgetModel, ArcGISMapIPyWidgetView } from './arcgis-map-ipywidget/arcgis-map-ipywidget.js';\r\nimport { version } from '../package.json';\r\nimport { Widget } from \"@lumino/widgets\";\r\nimport { toNewWindowEncoded } from './arcgis-map-ipywidget/images/images';\r\n\r\nimport { JupyterFrontEnd, JupyterFrontEndPlugin } from '@jupyterlab/application';\r\nimport { ICommandPalette } from '@jupyterlab/apputils';\r\n\r\nclass IPythonExtensionWidgetContainer extends Widget{\r\n    ///The jupyterlab container class that seperates the \r\n    ///widget from the notebook for you to view it side-by-side \r\n    originalParentElement: any;\r\n    ipywidgetElement: any;\r\n    constructor(element, title) {\r\n        super();\r\n        this.ipywidgetElement = element;\r\n        this.originalParentElement = element.parentElement\r\n        this.originalParentElement.removeChild(element);\r\n        this.node.appendChild(element);\r\n        this.id = \"ipywidget-external-window-container-\" + Math.random().toString(36).substring(7);\r\n        this.title.label = title;\r\n        this.title.closable = true;\r\n        this.addClass('IPythonExtensionWidgetContainer');\r\n    }\r\n\r\n    restoreToOriginalParentElement(msg){\r\n        this.originalParentElement.appendChild(this.ipywidgetElement);\r\n        while(this.node.hasChildNodes()){\r\n            this.node.removeChild(this.node.lastChild);\r\n            }\r\n        //TODO: find more elegant solution to this ugly hack\r\n        this.mapForAllChildrenOfIPyWidgetElement((childNode) => {\r\n            if(childNode.id && /.*new.*window/i.test(childNode.id)){\r\n                ///For the icon that was previously hidden, redisplay it\r\n                childNode.src = toNewWindowEncoded;\r\n                this.ipywidgetElement.style.height = this.ipywidgetElement.prevElementHeight;\r\n                }\r\n        });\r\n    }\r\n\r\n    mapForAllChildrenOfIPyWidgetElement(func){\r\n        var recursiveChildDescend = function(node){\r\n            for(var i=0; i < node.childElementCount; i++){\r\n                var child = node.childNodes[i];\r\n                recursiveChildDescend(child);\r\n                func(child);}};\r\n        recursiveChildDescend(this.ipywidgetElement);}};\r\n\r\n/**\r\n * Actually create the FrontEndPlugin to export, read by the\r\n * appropriate JupyterLab labextension manager\r\n */\r\nconst extension: JupyterFrontEndPlugin<void> = {\r\n  id: 'arcgis-map-ipywidget',\r\n  autoStart: true,\r\n  requires: [ICommandPalette, \r\n             IJupyterWidgetRegistry],\r\n  activate: (\r\n    app: JupyterFrontEnd,\r\n    palette: ICommandPalette,\r\n    widgets: IJupyterWidgetRegistry\r\n  ) => {\r\n\r\n    //Activate the base ipywidget to work in a notebook\r\n    const { commands, shell } = app;\r\n\r\n    widgets.registerWidget({\r\n        name: 'arcgis-map-ipywidget',\r\n        version: version,\r\n        exports: { ArcGISMapIPyWidgetModel : ArcGISMapIPyWidgetModel,\r\n                    ArcGISMapIPyWidgetView : ArcGISMapIPyWidgetView }\r\n    });\r\n\r\n    //Create the commands to move that map to an external window\r\n    //via class we've previously defined\r\n    const newWindowCommand = 'arcgis-map-ipywidget:new-window';\r\n    commands.addCommand(newWindowCommand, {\r\n      label: 'Move Existing ArcGIS Map IPyWidget to Seperate Window',\r\n      caption: '',\r\n      execute: (args : any) => {\r\n          if(!('element' in args)){\r\n              alert(\"Do not call this command from the command window UI, \" + \r\n                    \"it is called indirectly on the Python ipywidget instance.\");\r\n          } else {\r\n                ///TODO: Find more elegant, less global way to do this\r\n                console.log(\"Attempting to create new window with these args:\");\r\n                console.log(args);\r\n                var ipyExtWinCon = new IPythonExtensionWidgetContainer(args.element, args.title);\r\n                shell.activateById(ipyExtWinCon.id);\r\n\r\n                if(args.tab_mode === \"auto\"){\r\n                    autoPlaceInMainArea(app, ipyExtWinCon);\r\n                }\r\n                else{\r\n                    shell.add(ipyExtWinCon, \"main\", { mode: args.tab_mode });}}}\r\n    });\r\n    palette.addItem({ command: newWindowCommand, category: 'ArcGIS Map IPywidget'});\r\n    (<any>window).newJLabWindow = (args) => {\r\n        //Global function called by the `arcgis-map-ipywidget-view.js` file\r\n        app.commands.execute(\"arcgis-map-ipywidget:new-window\", args);};\r\n    \r\n    //Create the commands to close that map to its original location\r\n    const closeWindowCommand = 'arcgis-map-ipywidget:close-window';\r\n    commands.addCommand(closeWindowCommand, {\r\n      label: 'Close Existing ArcGIS Map IPyWidget to Original Location',\r\n      caption: '',\r\n      execute: (args : any) => {\r\n          if(!('element' in args)){\r\n              alert(\"Do not call this command from the command window UI, \" + \r\n                    \"it is called indirectly on the Python ipywidget instance.\");\r\n          } else {\r\n            console.log(\"Attempting to close window with these args:\");\r\n            console.log(args);\r\n            var phosphorWidgets = getAllPhosphorWidgets();\r\n                for(var j in phosphorWidgets){\r\n                    var pwidget = phosphorWidgets[j];\r\n                    if(pwidget.node != null){\r\n                        for(var k in pwidget.node.children){\r\n                            var child = pwidget.node.children[k];\r\n                            if(child.id == args.element.id){\r\n                                pwidget.restoreToOriginalParentElement();\r\n                                pwidget.close();\r\n                                break;}}}}}}\r\n    });\r\n    palette.addItem({ command: closeWindowCommand, category: 'ArcGIS Map IPywidget'});\r\n    (<any>window).closeJLabWindow = function(args){\r\n        //Global function called by the `arcgis-map-ipywidget-view.js` file\r\n        app.commands.execute('arcgis-map-ipywidget:close-window', args);};\r\n\r\n    //Miscellaneous helper functions\r\n    const autoPlaceInMainArea = function(app, ipyExtWinCon){\r\n    try{\r\n        var numPhosphorWidgetsInMain = 0;\r\n        var widgets = app.shell.widgets(\"main\");\r\n        var widget;\r\n        while (widget = widgets.next()){\r\n                numPhosphorWidgetsInMain++;}\r\n        var numWidgetsInCurrentTab = app.shell._currentTabBar().titles.length;\r\n        var numActiveWindows = numPhosphorWidgetsInMain - numWidgetsInCurrentTab + 1;\r\n        console.log(\"Attempting to autoplace widget among \" + numActiveWindows + \r\n            \" other active widgets.\");\r\n        if(numActiveWindows <= 1){\r\n            app.shell.add(ipyExtWinCon, \"main\", {mode: \"split-right\"});\r\n        } else {\r\n            app.shell.add(ipyExtWinCon, \"main\", {mode: \"tab-after\"});\r\n        }\r\n    } catch(err) {\r\n        console.log(\"Unhandled error while 'auto' mode of placing tabs\" + \r\n            \". Just adding this widget in 'tab-after' mode\");\r\n        console.log(err);\r\n        app.shell.add(ipyExtWinCon, \"main\", {mode: \"tab-after\"});}};\r\n\r\n    const getAllPhosphorWidgets = function(){\r\n        var outputWidgets = []\r\n        var areas = ['main', 'left', 'right', 'top', 'bottom'];\r\n        for(var i in areas){\r\n            var area = areas[i];\r\n            try{\r\n                var widgets = app.shell.widgets(area);\r\n                var widget;\r\n                while (widget = widgets.next()){\r\n                    outputWidgets.push(widget);}\r\n        } catch(err) {\r\n            //ignore errors, since not all jlab instances have all of\r\n            //left, right, top, bottom, etc.\r\n        }}\r\n    return outputWidgets;}}\r\n\r\n};\r\n\r\nexport default extension;","ArcGISMapIPyWidgetModel = require('./arcgis-map-ipywidget-model')\r\nArcGISMapIPyWidgetView = require('./arcgis-map-ipywidget-view')\r\n\r\nmodule.exports = {\r\n    ArcGISMapIPyWidgetModel : ArcGISMapIPyWidgetModel,\r\n    ArcGISMapIPyWidgetView : ArcGISMapIPyWidgetView\r\n};\r\n","//The main module that exports the javascript widget class\r\n\r\n//import all external modules\r\nconst widgets = require('@jupyter-widgets/base');\r\nconst _ = require('lodash');\r\nconst version = require('../../package.json').version;\r\n\r\n// The Model that stores state on the javascript side\r\nvar ArcGISMapIPyWidgetModel = widgets.DOMWidgetModel.extend({\r\n    defaults: _.extend(widgets.DOMWidgetModel.prototype.defaults(), {\r\n        _model_name : 'ArcGISMapIPyWidgetModel',\r\n        _view_name : 'ArcGISMapIPyWidgetView',\r\n        _model_module : 'arcgis-map-ipywidget',\r\n        _view_module : 'arcgis-map-ipywidget',\r\n        _model_module_version : version,\r\n        _view_module_version : version,\r\n\r\n        value : 'From Scene Model',\r\n\r\n        //start map specific draw state\r\n        _basemap: \"topo\",\r\n        _gallery_basemaps: {},\r\n        mode: \"2D\",\r\n        _zoom: -1,\r\n        _readonly_zoom: -1,\r\n        _scale: -1,\r\n        _snap_to_zoom: true,\r\n        _readonly_scale: -1,\r\n        _rotation: 0,\r\n        _readonly_rotation: 0,\r\n        _link_writeonly_rotation: 0,\r\n        _heading: 0,\r\n        _readonly_heading: 0,\r\n        _link_writeonly_heading: 0,\r\n        _tilt: 0,\r\n        _readonly_tilt: 0,\r\n        _link_writeonly_tilt: 0,\r\n        _extent: {},\r\n        _readonly_extent: {},\r\n        _link_writeonly_extent: {},\r\n        _center: {},\r\n        _readonly_center: {},\r\n        _center_long_lat: [],\r\n        //end map specific draw state\r\n        //start layer specific model state\r\n        _func_chains: [],\r\n        _add_this_notype_layer: {},\r\n        _readonly_notype_layers: {},\r\n        _draw_these_notype_layers_on_widget_load: {},\r\n        _layers_to_remove: [],\r\n        _add_this_graphic: {},\r\n        _draw_these_graphics_on_widget_load: {},\r\n        //end layer specific model state\r\n        //start webmap/webscene state\r\n        _webmap: {},\r\n        _webscene: {},\r\n        _trigger_webscene_save_to_this_portal_id: \"\",\r\n        _readonly_webmap_from_js: {},\r\n        //end webmap/webscene state\r\n\r\n        //Start screenshot section\r\n        _preview_screenshot_callback_resp: \"\",\r\n        _cell_output_screenshot_callback_resp: \"\",\r\n        _file_output_screenshot_callback_resp: \"\",\r\n        _trigger_screenshot_with_args: {},\r\n        //end screenshot section\r\n\r\n        //start image overlay section\r\n        _overlay_this_image: {},\r\n        _overlay_these_images_on_widget_load: {},\r\n        _image_overlays_to_remove: [],\r\n        //end image overlay section\r\n\r\n        //start time information\r\n        time_slider: false,\r\n        time_mode: \"time-window\",\r\n        _time_info: {},\r\n        _writeonly_start_time: \"\",\r\n        _readonly_start_time: \"\",\r\n        _writeonly_end_time: \"\",\r\n        _readonly_end_time: \"\",\r\n        //end time info\r\n\r\n        //start miscellanous model state\r\n        _portal_token: \"\",\r\n        _auth_mode: \"\",\r\n        _portal_url: \"\",\r\n        _portal_sharing_rest_url: \"\",\r\n        _username: \"\",\r\n        _custom_msg: \"\",\r\n        hide_mode_switch: false,\r\n        _trigger_interactive_draw_mode_for: \"\",\r\n        _trigger_new_jlab_window_with_args: {},\r\n        jupyter_target: \"\",\r\n        ready: false,\r\n        tab_mode: \"auto\",\r\n        _js_cdn_override: \"\",\r\n        legend: false,\r\n        _uuid: \"\",\r\n        _trigger_print_js_debug_info: \"\",\r\n        //end miscellanous modle state\r\n\r\n\r\n    })\r\n});\r\n\r\nmodule.exports = ArcGISMapIPyWidgetModel;\r\n","//The main module that exports the javascript widget class\r\n\r\n//import all external modules\r\nconst widgets = require('@jupyter-widgets/base');\r\nconst _ = require('lodash');\r\n\r\n//import all helper functions\r\nvar createElements = require('./elements/create-elements');\r\nvar displayPureJSErrorBox = require('./elements/display-purejs-error-box');\r\nvar loadingProgressDisplay = require('./elements/loading-progress-display');\r\nvar inferNoTypeLayer = require('./layer-utils/infer-no-type-layer');\r\nvar getImageOverlayLayerType = require('./layer-utils/get-image-overlay-layer-type');\r\nvar images = require('./images/images');\r\nvar mainCssString = require('../css/main.css').toString();\r\nvar configureCDN = require(\"../config/configure-cdn\");\r\n\r\n//import the configuration and the specific esri-loader based off the config\r\nvar config = require(\"config\")\r\nvar getEsriLoader = require('./loaders/get-esri-loader');\r\nvar esriLoader = getEsriLoader(config);\r\nvar options = config.EsriLoaderOptions;\r\n\r\nconsole.log(\"Using this config:\");\r\nconsole.log(config);\r\n\r\n//Apply the mainCssString defined in ../css/main.css\r\nvar _applyCssString = function(cssString){\r\n    var style = document.createElement(\"style\");\r\n    style.innerHTML = cssString;\r\n    document.head.appendChild(style);\r\n}\r\n_applyCssString(mainCssString);\r\n\r\n//Apply the ArcGIS JS API's main.css to the document\r\nvar _applyCssFromUrl = function(url){\r\n    var link = document.createElement(\"link\");\r\n    link.rel = \"stylesheet\";\r\n    link.href = url\r\n    document.head.appendChild(link);\r\n}\r\n_applyCssFromUrl(config.CdnMainCssUrl);\r\n\r\n//The arbitrary layer ID for all layers that we only want 1 instance of\r\nconst graphicsLayerId = \"graphicsLayerId31195\";\r\nconst imageOverlayLayerId = \"imageOverlayLayerId551883\";\r\n\r\n// Each new widget instantiated on the Python side has a uuid field\r\n// If a python widget displays in a notebook twice, there will be two\r\n// instances of the JS widget with the same uuid, but still the 1 python inst.\r\n// This global dictionary will have each key be the uuid, and each value\r\n// be the token associated with the portal. This is needed due to security \r\n// concerns of not storing the token in the model (which can be persisted on \r\n// disk), and due to the unpredictable nature of traitlets/backbone.\r\n// TODO: find a more elegant solution to this\r\nvar globalTokenLookup = {};\r\n\r\nvar ArcGISMapIPyWidgetView = widgets.DOMWidgetView.extend({\r\n    render: function() {\r\n    ///This is called once the first time the widget is drawn in the notebook\r\n    this._override_right_click_menu();\r\n    this._setup_js_cdn();\r\n    this._setup_elements();\r\n    this.model.set(\"jupyter_target\", config.JupyterTarget);\r\n    loadingProgressDisplay.start();\r\n    esriLoader.loadModules(['esri/Map',\r\n                            'esri/views/MapView',\r\n                            'esri/WebMap',\r\n                            'esri/WebScene',\r\n                            'esri/views/SceneView',\r\n                            'esri/core/watchUtils',\r\n                            'esri/widgets/Compass',\r\n                            'esri/widgets/Legend',\r\n                            'esri/widgets/TimeSlider'], options).then((\r\n                            [Map,\r\n                             MapView,\r\n                             WebMap,\r\n                             WebScene,\r\n                             SceneView,\r\n                             watchUtils,\r\n                             Compass,\r\n                             Legend,\r\n                             TimeSlider]) => {\r\n        loadingProgressDisplay.stop();\r\n        this._setup_custom_buttons();\r\n        this._instantiate_esri_components(Map, WebMap, WebScene, \r\n                                          MapView, SceneView,\r\n                                          Compass, Legend, TimeSlider);\r\n        this._miscellanous_setup();\r\n        //All model specific change functions. These functions are called\r\n        //whenever that attribute on the model is updated, whether that update\r\n        //comes from Python, from the UI, etc. The callback function is called on change\r\n        //start map specific draw state\r\n        this.model.on('change:mode', this.mode_changed, this);\r\n        this.model.on('change:_basemap', this.basemap_changed, this);\r\n        this.model.on('change:_zoom', this.zoom_changed, this);\r\n        this.model.on('change:_scale', this.scale_changed, this);\r\n        this.model.on('change:_snap_to_zoom', this.snap_to_zoom_changed, this);\r\n        this.model.on('change:_rotation', this.rotation_changed, this);\r\n        this.model.on('change:_link_writeonly_rotation', this.link_rotation_changed, this);\r\n        this.model.on('change:_heading', this.heading_changed, this);\r\n        this.model.on('change:_link_writeonly_heading', this.link_heading_changed, this);\r\n        this.model.on('change:_tilt', this.tilt_changed, this);\r\n        this.model.on('change:_link_writeonly_tilt', this.link_tilt_changed, this);\r\n        this.model.on('change:_extent', this.extent_changed, this);\r\n        this.model.on('change:_link_writeonly_extent', this.link_extent_changed, this);\r\n        this.model.on('change:_center', this.center_changed, this);\r\n        this.model.on('change:_center_long_lat', this.center_long_lat_changed, this);\r\n        //start layer specific model types\r\n        this.model.on('change:_func_chains', this.func_chains_changed, this);\r\n        this.model.on('change:_add_this_notype_layer', this.add_this_notype_layer_changed, this);\r\n        this.model.on('change:_layers_to_remove', this.layers_to_remove_changed, this);\r\n        this.model.on('change:_add_this_graphic', this.graphics_changed, this);\r\n        //end layer specific model types\r\n        //start webmap/websceme section\r\n        this.model.on('change:_webmap', this.webmap_changed, this);\r\n        this.model.on('change:_webscene', this.webscene_changed, this);\r\n        this.model.on('change:_trigger_webscene_save_to_this_portal_id', this.save_webscene, this);\r\n        //end webmap/webscene section\r\n\r\n        //start screenshot section\r\n        this.model.on('change:_trigger_screenshot_with_args', this._trigger_screenshot_with_args_changed, this);\r\n        //end screenshot section\r\n\r\n        //start image overlay section\r\n        this.model.on('change:_overlay_this_image', this.overlay_image_changed, this);\r\n        this.model.on('change:_image_overlays_to_remove', this.image_overlays_to_remove_changed, this);\r\n        //end image overlay section\r\n\r\n        //start time section\r\n        this.model.on('change:time_slider', this.time_slider_prop_changed, this);\r\n        this.model.on('change:time_mode', this.time_mode_changed, this);\r\n        this.model.on('change:_time_info', this.time_info_changed, this);\r\n        this.model.on('change:_writeonly_start_time', this.start_time_changed, this);\r\n        this.model.on('change:_writeonly_end_time', this.end_time_changed, this);\r\n        //end time section\r\n\r\n        //start miscellanous model section\r\n        this.model.on('change:_portal_token', this.portal_token_changed, this);\r\n        this.model.on('change:_custom_msg', this.custom_msg_changed, this);\r\n        this.model.on('change:hide_mode_switch', this.hide_mode_switch_changed, this);\r\n        this.model.on('change:_trigger_interactive_draw_mode_for', this.interactive_draw_shape, this);\r\n        this.model.on('change:_trigger_new_jlab_window_with_args', this.trigger_jlab_window_changed, this);\r\n        this.model.on('change:_js_cdn_override', this.js_cdn_changed, this);\r\n        this.model.on('change:legend', this.legend_prop_changed, this);\r\n        this.model.on('change:_trigger_print_js_debug_info', this.trigger_print_js_debug_info_changed, this);\r\n        //end miscellanous model section\r\n\r\n        //Last thing to do: update the widget state from the model's\r\n        this.update_widget_from_model().then(() => {\r\n            this._postLoadSetup(watchUtils);\r\n        });\r\n    }).catch((err) => {\r\n       this._displayErrorBox();\r\n       console.warn(\"Error on render: \"); console.warn(err);\r\n        });\r\n    },\r\n\r\n    update_widget_from_model: function(){\r\n        return new Promise((resolve, reject) => {\r\n            //start map specific draw state\r\n            this.mode_changed();\r\n            this.basemap_changed();\r\n            this.zoom_changed();\r\n            this.scale_changed();\r\n            this.snap_to_zoom_changed();\r\n            this.rotation_changed();\r\n            this.heading_changed();\r\n            this.tilt_changed();\r\n            this.center_long_lat_changed();\r\n            this.center_changed();\r\n            this.extent_changed();\r\n            //end map specific draw state\r\n            //start miscellanous model section\r\n            this.hide_mode_switch_changed();\r\n            this.portal_token_changed();\r\n            this.authenticate_to_portal().then((_) => {\r\n                //Authenticate to the portal before attempting to load anything\r\n                //end miscellanous model section\r\n                //start layer specific model calls\r\n                this.draw_these_notype_layers_on_widget_load();\r\n                this.draw_these_graphics_on_widget_load();\r\n                this.overlay_these_images_on_widget_load();\r\n                //end layer specific model calls\r\n                //start webmap/webscene section\r\n                this.webmap_changed();\r\n                this.webscene_changed();\r\n                //end webmap/webscene section\r\n                this.legend_prop_changed();\r\n                //start time section\r\n                this.time_slider_prop_changed();\r\n                this.time_mode_changed();\r\n                this.time_info_changed();\r\n                //end time section\r\n\r\n                resolve();\r\n            }).catch((err) => {\r\n                this._displayErrorBox(\"Error while authenticating to portal on first load.\");\r\n                console.warn(\"Error during portal auth\"); console.warn(err);\r\n                reject(err);\r\n            });\r\n        })\r\n    },\r\n\r\n\r\n    _displayErrorBox: function(msg, browser_console_message = true){\r\n        ///A simple message box display mechanism\r\n        if (!msg){\r\n            msg = \"Unhandled Error! See the browser console for more info.\";\r\n        }\r\n        else if (browser_console_message) {\r\n            msg += \" See the browser console for more info.\";\r\n        }\r\n        loadingProgressDisplay.stop();\r\n        if (!document.getElementById(this.elements.errorTextBox.id)){\r\n            //If everything has failed to load, add the error box so it displays\r\n            this.el.appendChild(this.elements.errorTextBox);\r\n        }\r\n        if(!this.elements.errorTextBox.textContent){\r\n            //If there's no current message box open\r\n            displayPureJSErrorBox(msg, this.elements); \r\n        } else {\r\n            //There's another message still open: save all messages\r\n            //to browser console and alert user\r\n            var multiple_messages_info = \"Multiple messages attempted to \" + \r\n                \"display. See browser console to view all messages\";\r\n            if(this.elements.errorTextBox.textContent !== multiple_messages_info){\r\n                console.warn(\"*****MESSAGE_BOX: \" +\r\n                    this.elements.errorTextBox.textContent);\r\n            }\r\n            console.warn(\"*****MESSAGE_BOX: \" + msg);\r\n            displayPureJSErrorBox(multiple_messages_info, this.elements);\r\n        }\r\n    },\r\n\r\n    _setup_elements: function(){\r\n        this.uuid = this.model.get('_uuid');\r\n        this.elements = createElements(this.uuid);\r\n        this.el.className = \"arcgisMapIPyWidgetDiv\";\r\n        this.el.style.height = \"100%\";\r\n        this.el.style.width = \"100%\";\r\n        this.el.appendChild(this.elements.viewdivElement);\r\n    },\r\n\r\n    _setup_custom_buttons: function(){\r\n        ///Now that we're loaded, add the 2D/3D switch, new window button, etc\r\n        //2D/3D switch setup\r\n        this.elements.infodivElement.appendChild(this.elements.switchButton);\r\n        this.elements.switchButton.onclick = () => {\r\n            if(this.model.get(\"mode\") === \"3D\"){\r\n                this.model.set(\"mode\", \"2D\");\r\n                this.touch();\r\n            } else {\r\n                this.model.set(\"mode\", \"3D\");\r\n                this.touch();\r\n            }\r\n        }\r\n        //jupyterlab new window button setup\r\n        if(config.JupyterTarget === \"lab\"){\r\n            this.elements.infodivElement.appendChild(this.elements.newWindowButton);\r\n            this.elements.newWindowButton.onclick = () => {\r\n                this.move_to_new_jlab_window({title: \"ArcGIS Map\"});\r\n            }\r\n        }\r\n    },\r\n\r\n    _setup_2d_stationary_callback: function(watchUtils){\r\n        //The moment the mouse enters the arcgis js api 2d view (not parent element),\r\n        //Set up responses to the 'stationary' callback (i.e., what logic to run\r\n        //when the user clicks the map, zooms, changes extent, etc.). Only set this up once\r\n        this._MapView._pointerMoveHandler = this._MapView.on(\r\n            ['pointer-move', 'key-down'], (event) => {\r\n                console.log(\"Started interacting with the 2D map, \" + \r\n                    \"setting up stationary callback...\");\r\n                watchUtils.when(this._MapView, \"stationary\", this._2dStationaryCallback)\r\n                this._MapView._pointerMoveHandler.remove();\r\n        });\r\n    },\r\n\r\n    _setup_3d_stationary_callback: function(watchUtils){\r\n        //Same as above, but for the 3D SceneView\r\n        this._SceneView._pointerMoveHandler = this._SceneView.on(\r\n            ['pointer-move', 'key-down'], (event) => {\r\n                console.log(\"Started interacting with the 3D map, \" + \r\n                    \"setting up stationary callback...\");\r\n                watchUtils.when(this._SceneView, \"stationary\", this._3dStationaryCallback)\r\n                this._SceneView._pointerMoveHandler.remove();\r\n        });\r\n    },\r\n\r\n    _2dStationaryCallback: function(){\r\n        ///Do 2D specific stationary callbacks before common stuff\r\n        var widget_inst = this._parentIPyWidget;\r\n\r\n        var rotation = this.rotation;\r\n        if(rotation >= 0){\r\n            widget_inst.model.set(\"_readonly_rotation\", rotation);\r\n            var heading = 360 - rotation;\r\n            widget_inst.model.set(\"_readonly_heading\", heading);\r\n            widget_inst.apply_heading_to_view(heading);\r\n        }\r\n\r\n        widget_inst._commonStationaryCallback(widget_inst);\r\n    },\r\n\r\n    _3dStationaryCallback: function(){\r\n        ///Do 3D specific stationary callbacks before common stuff\r\n        var widget_inst = this._parentIPyWidget;\r\n\r\n        var camera = this.camera;\r\n        if(camera){\r\n            widget_inst.model.set(\"_readonly_heading\", camera.heading);\r\n            var rotation = 360 - camera.heading;\r\n            widget_inst.model.set(\"_readonly_rotation\", rotation);\r\n            widget_inst.apply_rotation_to_view(rotation);\r\n            widget_inst.model.set(\"_readonly_tilt\", camera.tilt);\r\n        }\r\n\r\n        widget_inst._commonStationaryCallback(widget_inst);\r\n    },\r\n\r\n    _commonStationaryCallback: function(widget_inst){\r\n        ///This function is a callback for the 'stationary' event on the activeView\r\n        ///('stationary' is when the map stops moving on a zoom, a pan, etc.)\r\n        ///Since it is a callback, 'this' is actually the instance of either the\r\n        ///the 2d MapView or 3D SceneView\r\n        var zoom = widget_inst.activeView.zoom;\r\n        if(zoom >= 0){\r\n            //this callback is sometimes errenously called, displaying nonexistant values\r\n            widget_inst.model.set(\"_readonly_zoom\", zoom);}\r\n\r\n        var scale = widget_inst.activeView.scale;\r\n        if(scale >= 1){\r\n            widget_inst.model.set(\"_readonly_scale\", scale);}\r\n\r\n        var center = widget_inst.activeView.center;\r\n        if(center){\r\n            widget_inst.model.set(\"_readonly_center\", JSON.parse(JSON.stringify(center)));}\r\n\r\n        var extent = widget_inst.activeView.extent;\r\n        if(extent){\r\n            widget_inst.model.set(\"_readonly_extent\", JSON.parse(JSON.stringify(extent)));}\r\n\r\n        widget_inst.model.save_changes();\r\n    },\r\n\r\n    _miscellanous_setup: function(){\r\n       ///Every time the 2d map changes a basemap/ground/layer, call this function\r\n        this.map.allLayers.on('change', (event) => {\r\n            this.update_readonly_webmap();\r\n        });\r\n    },\r\n\r\n    _postLoadSetup: function(watchUtils){\r\n        //Whenever either the 2d or 3d view loads, set model var 'ready' to\r\n        //true for python to consume\r\n        console.log(\"Running post load setup for \" + config.JSOutputContext);\r\n        this._MapView.when(() => {\r\n            console.log(\"2D map ready\");\r\n            this.model.set('ready', true)\r\n            this.model.set('_readonly_extent', this._MapView.extent);\r\n            this.model.set('_readonly_center', this._MapView.center);\r\n            this.model.save_changes();\r\n            this.zoom_changed(); //Fixes quick redraw bug of zoom not honored\r\n            this._setup_2d_stationary_callback(watchUtils);\r\n        });\r\n\r\n        this._SceneView.when(() => {\r\n            console.log(\"3D map ready\");\r\n            this.model.set('ready', true)\r\n            this.model.set('_readonly_extent', this._SceneView.extent);\r\n            this.model.set('_readonly_center', this._SceneView.center);\r\n            this.model.save_changes();\r\n            this.zoom_changed(); //Fixes quick redraw bug of zoom not honored\r\n            this.tilt_changed(); //'' '' '' '' '' '' ''' ''  tilt not honored\r\n            this._setup_3d_stationary_callback(watchUtils);\r\n        });\r\n\r\n        //Whenever you click on the map, send an event for python to listen to\r\n        this._MapView.on(['click'], (event_) => {\r\n            this.send({ event: 'mouseclick', message: event_.mapPoint });\r\n        });\r\n\r\n        this._SceneView.on(['click'], (event_) => {\r\n            this.send({ event: 'mouseclick', message: event_.mapPoint });\r\n        });\r\n\r\n        // Apply CSS to hide any image preview and HTML embed preview in the \r\n        // live notebook (but keep it in the underlying notebook file)\r\n        //\r\n        // Don't do this when this JS code is called from the embedded\r\n        // widget itself (i.e. when MapView.embed() or MapView.export_to_html()\r\n        // is called)\r\n        if(config.JSOutputContext === \"default\"){\r\n            this._hidePreviewEls();}\r\n\r\n        // Add screenshot keyboard shortcut\r\n        this._set_screenshot_keyboard_shortcut();\r\n    },\r\n\r\n    _hidePreviewEls: function(){\r\n        console.log(\"Hiding preview elements for \" + this.uuid);\r\n        var cssEl = document.createElement('style');\r\n        cssEl.type = 'text/css';\r\n        cssEl.innerHTML = 'div.map-static-img-preview-' +\r\n            this.uuid + ' { display: none }\\n' + \r\n            'div.map-html-embed-preview-' +\r\n            this.uuid + ' { display: none }';\r\n        document.head.appendChild(cssEl);\r\n    },\r\n\r\n    _setup_js_cdn: function(){\r\n        //set up any CDN override before we call esri modules\r\n        this.model.on('change:_js_cdn_override', this.js_cdn_changed, this);\r\n        this.js_cdn_changed();\r\n    },\r\n\r\n    _instantiate_esri_components: function(Map, WebMap, WebScene, MapView, SceneView,\r\n                                           Compass, Legend, TimeSlider){\r\n        this.container = this.elements.mapElement;\r\n        var mode = this.model.get(\"mode\").toLowerCase();\r\n        if(mode === \"2d\"){\r\n            this.map = new WebMap({ground: \"world-elevation\"});\r\n            this._MapView = new MapView({\r\n                map: this.map,\r\n                container: this.container});\r\n            this.activeView = this._MapView;\r\n            this._SceneView = new SceneView({map: this.map});\r\n        } else if(mode === \"3d\"){\r\n            this.map = new WebScene({ground: \"world-elevation\"});\r\n            this._SceneView = new SceneView({\r\n                map: this.map,\r\n                container: this.container});\r\n            this.activeView = this._SceneView;\r\n            this._MapView = new MapView({map: this.map});}\r\n        this._MapView._parentIPyWidget = this\r\n        this._SceneView._parentIPyWidget = this;\r\n\r\n        //Set the default zoom to a model-less number that looks a bit nicer\r\n        this._MapView.zoom = 2;\r\n        this._SceneView.zoom = 2;\r\n\r\n        // Set up widgets like compass and legend\r\n        this._MapView.ui.add(new Compass({view: this._MapView}), \"top-left\");\r\n        this._time_slider = new TimeSlider({\r\n            view: this.activeView,\r\n            container: document.createElement(\"div\"),\r\n            mode: \"time-window\"});\r\n        this._time_slider.watch('values', (values) => {\r\n            this.time_slider_values_changed(values);});\r\n        this._legend = new Legend({\r\n            view: this.activeView,\r\n            layerInfos: []});\r\n   },\r\n\r\n    _override_right_click_menu: function(){\r\n        //JupyterLab has a right click menu we don't want displaying\r\n        //when the map is right clicked to rotate\r\n        this.el.addEventListener('contextmenu', function(e) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            return false;\r\n        }, false);\r\n    },\r\n\r\n    _set_screenshot_keyboard_shortcut: function(){\r\n        this.el.addEventListener('keydown', (e) => {\r\n            if (e.shiftKey && e.key ===\"P\"){\r\n                this.model.set(\"_trigger_screenshot_with_args\",\r\n                    {\"_\" : this._get_uuidv4(),\r\n                     \"set_as_preview\": true,\r\n                     \"output_in_cell\": false,\r\n                     \"file_path\": false});\r\n                this.model.save_changes();\r\n            }\r\n        });\r\n    },\r\n\r\n    _get_uuidv4: function() {\r\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, \r\n          function(c) {\r\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n          });\r\n    },\r\n\r\n    custom_msg_changed: function(){\r\n        var _custom_msg = this.model.get(\"_custom_msg\");\r\n        if(_custom_msg){\r\n            this._displayErrorBox(_custom_msg,\r\n                                  browser_console_message = false);\r\n        }\r\n    },\r\n\r\n    basemap_changed: function () {\r\n        esriLoader.loadModules(['esri/Basemap'],\r\n        options).then(([Basemap]) => {\r\n            console.log(\"updating basemap...\");\r\n            var basemapStr = this.model.get('_basemap');\r\n            var galleryBasemaps = this.model.get('_gallery_basemaps');\r\n            if (basemapStr in galleryBasemaps){\r\n                //If the basemap passed in is in the gallery, use it\r\n                var basemapJSON = galleryBasemaps[basemapStr];\r\n                var basemap = Basemap.fromJSON(basemapJSON);\r\n                this.map.basemap = basemap;\r\n            } else {\r\n                //Else, just pass the str to the map (it can autocast)\r\n                this.map.basemap = basemapStr\r\n            }\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error while changing basemap.\");\r\n            console.warn(\"Error on basemap_change: \"); console.warn(err)\r\n        });\r\n    },\r\n\r\n    trigger_print_js_debug_info_changed: function(){\r\n        console.log(\"Widget = \");\r\n        console.log(this);\r\n        console.log(\"Global token lookup = \");\r\n        console.log(globalTokenLookup);\r\n    },\r\n\r\n    mode_changed: function(){\r\n    esriLoader.loadModules(['esri/WebMap', 'esri/WebScene'],\r\n    options).then(([WebMap, WebScene]) => { \r\n        console.log(\"updating mode...\");\r\n        var mode = this.model.get(\"mode\").toLowerCase();\r\n        if(mode === \"3d\"){\r\n            this.elements.switchButton.src = images.sceneToMapEncoded;\r\n            if(this.activeView.viewpoint){\r\n                this._SceneView.viewpoint = this.activeView.viewpoint.clone();\r\n                this.activeView.container = null;}\r\n            this._SceneView.container = this.container;\r\n            this.activeView = this._SceneView;\r\n            this.map = new WebScene({ground: this.map.ground,\r\n                                     basemap: this.map.basemap,\r\n                                     layers: this.map.layers});\r\n            this._SceneView.map = this.map\r\n            this._MapView.map = null;\r\n        } else {\r\n            this.elements.switchButton.src = images.mapToSceneEncoded;\r\n            if(this.activeView.viewpoint){\r\n                this._MapView.viewpoint = this.activeView.viewpoint.clone();\r\n                this.activeView.container = null;}\r\n             this._MapView.container = this.container;\r\n             this.activeView = this._MapView;\r\n             this.map = new WebMap({ground: this.map.ground,\r\n                                    basemap: this.map.basemap,\r\n                                    layers: this.map.layers});\r\n             this._MapView.map = this.map;\r\n             this._SceneView.map = null;\r\n             //Set the 'tilt' to 0 whenever switching to 2D mode\r\n             this.model.set(\"tilt\", 0);\r\n             this.model.save_changes();}\r\n        this.legend_prop_changed(); //Needed to reset the legend's view\r\n        this.time_slider_prop_changed();\r\n        this.map.allLayers.on('change', (event) => {\r\n            this.update_readonly_webmap();}); \r\n    }).catch((err) => {\r\n        this._displayErrorBox();\r\n        console.warn(\"Error on mode_changed\"); console.warn(err); \r\n    });},\r\n\r\n    zoom_changed: function(){\r\n        try{\r\n            var zoom = this.model.get(\"_zoom\");\r\n            this.model.set(\"_readonly_zoom\", zoom);\r\n            if(zoom >= 0){\r\n                this.activeView.zoom = zoom;}\r\n            this.model.save_changes();\r\n        } catch(err){\r\n            this._displayErrorBox(\"Error while modifying zoom.\");\r\n            console.warn(\"Error on zoom\"); console.warn(err);\r\n        }\r\n    },\r\n\r\n    scale_changed: function(){\r\n        try{\r\n            var scale = this.model.get(\"_scale\");\r\n            this.model.set(\"_readonly_scale\", scale);\r\n            this.model.save_changes();\r\n            if(scale >= 1){\r\n                this.activeView.scale = scale;\r\n            }\r\n        } catch(err) {\r\n            this._displayErrorBox(\"Error while modifying scale\");\r\n            console.warn(\"Error on scale\"); console.warn(err);\r\n        }\r\n    },\r\n\r\n    snap_to_zoom_changed: function(){\r\n        try{\r\n            var mode = this.model.get(\"mode\")\r\n            var snapToZoom = this.model.get(\"_snap_to_zoom\");\r\n            if(mode === \"2D\"){\r\n                this.activeView.constraints.snapToZoom = snapToZoom;}\r\n        } catch(err) {\r\n            this._displayErrorBox(\"Error while modifying snap to zoom\");\r\n            console.warn(\"Error on snap to zoom\"); console.warn(err);\r\n        }\r\n    },\r\n\r\n    rotation_changed: function(){\r\n        try{\r\n            var rotation = this.model.get(\"_rotation\");\r\n            this.model.set(\"_readonly_rotation\", rotation);\r\n            this.model.save_changes();\r\n            this.apply_rotation_to_view(rotation);\r\n        } catch(err){\r\n            this._displayErrorBox(\"Error while modifying rotation\");\r\n            console.warn(\"Error on rotation\"); console.warn(err);\r\n        }\r\n    },\r\n\r\n    link_rotation_changed: function(){\r\n        var rotation = this.model.get(\"_link_writeonly_rotation\");\r\n        this.apply_rotation_to_view(rotation);\r\n    },\r\n\r\n    apply_rotation_to_view: function(rotation){\r\n        this._MapView.rotation = rotation;\r\n    },\r\n\r\n    heading_changed: function(){\r\n        var heading = this.model.get(\"_heading\");\r\n        this.model.set(\"_readonly_heading\", heading);\r\n        this.model.save_changes();\r\n        this.apply_heading_to_view(heading);\r\n    },\r\n\r\n    link_heading_changed: function(){\r\n        var heading = this.model.get(\"_link_writeonly_heading\");\r\n        this.apply_heading_to_view(heading);\r\n    },\r\n\r\n    apply_heading_to_view: function(heading){\r\n        var _applyHeading = () => {\r\n            //The actual function that is eventually called to apply the heading\r\n            this._SceneView.goTo({center: this._SceneView.center,\r\n                              heading: heading},\r\n                             {animate: false});\r\n        };\r\n        esriLoader.loadModules([\"esri/core/watchUtils\"],\r\n        options).then(([watchUtils]) => {\r\n            if(this._SceneView.camera){\r\n                //If the map is already initialized\r\n                _applyHeading();\r\n            } else{\r\n                //set up the callback when the camera is ready for consumption\r\n                watchUtils.once(this._SceneView, \"camera\", () => {\r\n                    _applyHeading();\r\n               })\r\n            }\r\n        }).catch((err) =>{\r\n            this._displayErrorBox(\"Error while modifying heading\");\r\n            console.warn(\"Error on heading\"); console.warn(err);\r\n        });\r\n\r\n    },\r\n\r\n    tilt_changed: function(){\r\n        var tilt = this.model.get(\"_tilt\");\r\n        this.model.set(\"_readonly_tilt\", tilt);\r\n        this.model.save_changes();\r\n        this.apply_tilt_to_view(tilt);\r\n    },\r\n\r\n    link_tilt_changed: function(){\r\n        var tilt = this.model.get(\"_link_writeonly_tilt\");\r\n        this.apply_tilt_to_view(tilt);\r\n    },\r\n\r\n    apply_tilt_to_view: function(tilt){\r\n        var _applyTilt = () => {\r\n            this._SceneView.goTo({center: this._SceneView.center,\r\n                              tilt: tilt},\r\n                             {animate: false});\r\n         };\r\n        esriLoader.loadModules([\"esri/core/watchUtils\"],\r\n        options).then(([watchUtils]) => {\r\n            if(this._SceneView.camera){\r\n                //If the map is already initialized\r\n                _applyTilt();\r\n           } else {\r\n                //Set up the callback when the camera is ready for consuption\r\n                watchUtils.once(this._SceneView, \"camera\", () => {\r\n                    _applyTilt();\r\n                });\r\n            }\r\n        }).catch((err) =>{\r\n            //TODO: Figure out why the 'h is null' error happens, fix it\r\n            //For now, don't display an error box, just log to console\r\n            //this._displayErrorBox(\"Error while modifying tilt\");\r\n            console.warn(\"Error on tilt\"); console.warn(err);\r\n        });\r\n    },\r\n\r\n    extent_changed: function(){\r\n        var extent = this.model.get(\"_extent\");\r\n        this.apply_extent_to_view(extent);\r\n    },\r\n\r\n    link_extent_changed: function(){\r\n        var extent = this.model.get(\"_link_writeonly_extent\");\r\n        this.apply_extent_to_view(extent);\r\n    },\r\n\r\n    apply_extent_to_view: function(extent){\r\n        esriLoader.loadModules(['esri/geometry/Extent',\r\n                                \"esri/geometry/SpatialReference\",\r\n                                \"esri/geometry/projection\"],\r\n        options).then(([Extent,\r\n                        SpatialReference,\r\n                        projection]) => {\r\n            if(extent.xmin){\r\n                //Prevents an error about a bad extent\r\n                this.activeView.extent = new Extent(extent);\r\n                projection.load().then(() => {\r\n                    this.activeView.extent = projection.project(\r\n                        new Extent(extent),\r\n                        SpatialReference.WebMercator);\r\n                });\r\n            }\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error while modifying extent.\");\r\n            console.warn(\"Error on extent\"); console.warn(err);\r\n        });\r\n    },\r\n\r\n    center_long_lat_changed: function(){\r\n        ///When the center is passed in as a [long,lat] list, add it to the view\r\n        ///Then watch the view until it changes center into the correct format,\r\n        ///which we will then update correctly via the _center model attribute\r\n        esriLoader.loadModules([\"esri/core/watchUtils\"],\r\n        options).then(([watchUtils]) => {\r\n            var _center_long_lat = this.model.get(\"_center_long_lat\");\r\n            if(_center_long_lat.length === 2){\r\n                console.log(\"Converting [long, lat] center to standard center...\");\r\n                //Set up the callback when the view's center is ready for consuption\r\n                watchUtils.once(this.activeView, \"center\", () => {\r\n                    console.log(\"Center is converted\");\r\n                    var view_center = JSON.parse(JSON.stringify(this.activeView.center));\r\n                    this.model.set(\"_center\", view_center);\r\n                    this.model.set(\"_center_long_lat\", []);\r\n                    this.model.save_changes();\r\n                })\r\n                //Actually update the center on the activeView to trigger the above\r\n                this.activeView.center = _center_long_lat\r\n            }\r\n       }).catch((err) =>{\r\n            this._displayErrorBox(\"Error while modifying center_long_lat.\");\r\n            console.warn(\"Error on center_long_lat\"); console.warn(err);\r\n        });\r\n \r\n    },\r\n\r\n    center_changed: function(){\r\n        ///this function is called when _center is in the correct format\r\n        try{\r\n            var _center = this.model.get(\"_center\");\r\n            if('x' in _center && 'y' in _center){\r\n                this.activeView.center = _center;\r\n            }\r\n        }catch(err){\r\n            this._displayErrorBox(\"Error while modifying center\");\r\n            console.warn(\"Error on center\"); console.warn(err);\r\n        }\r\n    },\r\n\r\n    webmap_changed: function(){\r\n    esriLoader.loadModules(['esri/WebMap']).then(([WebMap]) => {\r\n        console.log(\"Updating webmap...\");\r\n        var webmap_from_python = this.model.get(\"_webmap\");\r\n        if(Object.keys(webmap_from_python).length !== 0){\r\n            this.map = WebMap.fromJSON(webmap_from_python);\r\n            this._MapView.map = this.map;}\r\n    }).catch((err) => {\r\n        this._displayErrorBox(\"Error on loading webmap from portal\");\r\n        console.warn(\"Error on loading webmap\"); console.warn(err);\r\n    });\r\n    },\r\n\r\n    update_readonly_webmap: function() {\r\n        ///Whenever a layer/basemap/ground is changed, OR whenever the webmap\r\n        ///is directly changed, update an esri JSON representation of the webmap\r\n        ///for readonly consumption on the python side of things\r\n        try{\r\n            var map;\r\n            if(this._MapView.map){\r\n                map = this._MapView.map}\r\n            else {\r\n                map = this._SceneView.map\r\n            }\r\n            var layers_json = []\r\n            for(var i in map.layers.toArray()){\r\n                //TODO: Implement WebMap.toJSON() when it's added to JS API\r\n                var layer = map.layers.toArray()[i]\r\n                var layer_json = { id : layer.id,\r\n                                   normalization : layer.normalization,\r\n                                   refreshInterval : layer.refreshInterval,\r\n                                   url : layer.url };\r\n                if (layer.graphics){\r\n                    layer_json.graphics = [];\r\n                    for(var i in layer.graphics.toArray()){\r\n                        var graphic = layer.graphics.toArray()[i];\r\n                        var graphic_json = graphic.toJSON();\r\n                        graphic_json.shape = graphic.shape;\r\n                        layer_json.graphics.push(graphic_json);\r\n                    }\r\n                }\r\n                if (layer.renderer){\r\n                    layer_json.renderer = layer.renderer.toJSON();\r\n                    layer_json.rendererType = layer.renderer.declaredClass;}\r\n                layers_json.push(layer_json) }\r\n            var ground_json = map.ground ? map.ground.toJSON() : {}\r\n            var basemap_json = map.basemap ? map.basemap.toJSON() : {}\r\n            var wm = { layers : layers_json,\r\n                       ground : ground_json,\r\n                       basemap : basemap_json };\r\n            this.model.set('_readonly_webmap_from_js', wm);\r\n            this.model.save_changes();\r\n        } catch(err){\r\n            this._displayErrorBox(\"Error updating readonly webmap json.\");\r\n            console.warn(\"Error updating readonly webmap\"); console.warn(err); }\r\n    },\r\n\r\n    webscene_changed: function(){\r\n        esriLoader.loadModules(['esri/WebScene',\r\n                                'esri/Viewpoint',\r\n                                'esri/webscene/InitialViewProperties']).then(\r\n        ([WebScene, ViewPoint, InitialViewProperties]) => {\r\n        console.log(\"Updating webscene...\");\r\n        console.log(this.model.get(\"_webscene\"))\r\n        var webscene_from_python = this.model.get(\"_webscene\");\r\n        if(Object.keys(webscene_from_python).length !== 0){\r\n            this.authenticate_to_portal().then((portal) => {\r\n                webscene_from_python.portalItem.portal = portal;\r\n                var webscene = new WebScene(webscene_from_python);\r\n                webscene.load().then((webscene) => {\r\n                    this._SceneView.map = webscene;\r\n                    this.map = webscene;\r\n                }).catch((err) => {\r\n                    this._displayErrorBox(\"Error on loading webscene item\");\r\n                    console.warn(\"Error on loading webscene\"); console.warn(err);\r\n                });\r\n            }).catch((err) => {\r\n                this._displayErrorBox(\"Error on loading portal for webscene\");\r\n                console.warn(\"Error loading portal\"); console.warn(err);\r\n                \r\n            });\r\n        }\r\n    }).catch((err) => {\r\n        this._displayErrorBox(\"Error on loading webscene from portal\");\r\n        console.warn(\"Error on loading webscene\"); console.warn(err);\r\n    });\r\n    },\r\n\r\n    save_webscene: function(){\r\n        esriLoader.loadModules(['esri/WebScene',\r\n                                'esri/Ground',\r\n                                'esri/Basemap']).then(\r\n        ([WebScene,\r\n          Ground,\r\n          Basemap]) => {\r\n            this.authenticate_to_portal().then((portal) => {\r\n                var scene;\r\n                if(this._SceneView.map.declaredClass == \"WebScene\"){\r\n                    scene = new WebScene(this._SceneView.map.toJSON())}\r\n                else{\r\n                    scene = new WebScene({layers : this._SceneView.map.layers,\r\n                        ground : Ground.fromJSON(this._SceneView.map.ground.toJSON()),\r\n                        basemap : Basemap.fromJSON(this._SceneView.map.basemap.toJSON())});}\r\n                var portal_item_id = this.model.get(\"_trigger_webscene_save_to_this_portal_id\");\r\n                console.log(\"Starting to save webscene to portal item \" + portal_item_id); \r\n                scene.portalItem = {\r\n                        id: portal_item_id,\r\n                        portal: portal};\r\n                scene.load().then(() => {\r\n                    scene.ground = Ground.fromJSON(this._SceneView.map.ground.toJSON());\r\n                    scene.basemap = Basemap.fromJSON(this._SceneView.map.basemap.toJSON());\r\n                    scene.updateFrom(this._SceneView);\r\n                    scene.save({ignoreUnsupported: true}).then((item) => {\r\n                        console.log(\"The following item was saved:\");\r\n                        console.log(item.toJSON());\r\n                   }).catch((err) => {\r\n                        this._displayErrorBox(\"Error saving webscene\");\r\n                        console.warn(\"Error saving webscene\"); console.warn(err);\r\n                    });\r\n                    //TODO: clean up, figure out why layers are deleted on save\r\n                    this.reload_all_layers();\r\n                    this._SceneView.map = scene;\r\n                    this.map = scene;\r\n\r\n                }).catch((err) => {\r\n                    this._displayErrorBox(\"During load, error on loading webscene save\");\r\n                    console.warn(\"Error loading web scene\"); console.warn(err);\r\n                })\r\n            }).catch((err) => {\r\n                this._displayErrorBox(\"During portal auth, error on webscene save\");\r\n                console.warn(\"Error portal auth on webscene save\"); console.warn(err);});\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error on saving the web scene\");\r\n            console.warn(\"Error saving web scene\"); console.warn(err);\r\n        });\r\n    },\r\n\r\n    reload_all_layers: function(){\r\n        console.log(\"TODO: CHECK IF I'M BROKEN\");\r\n        this.draw_these_notype_layers_on_widget_load();\r\n    },\r\n\r\n    func_chains_changed: function(){\r\n            console.log(\"Updating func_chains...\");\r\n            console.log(this.model.get(\"_func_chains\"));\r\n    },\r\n\r\n    draw_these_notype_layers_on_widget_load: function(){\r\n        var layers = this.model.get('_draw_these_notype_layers_on_widget_load');\r\n        console.log(\"Drawing these layers on load... \");\r\n        console.log(layers);\r\n        for(var i in layers){\r\n            var noTypeLayer = layers[i];\r\n            this.add_notype_layer(noTypeLayer);\r\n        }\r\n    },\r\n\r\n    add_this_notype_layer_changed: function(){\r\n        var noTypeLayer = this.model.get(\"_add_this_notype_layer\");\r\n        if(Object.keys(noTypeLayer).length !== 0){\r\n            this.add_notype_layer(noTypeLayer);\r\n       }\r\n   },\r\n\r\n    add_notype_layer: function(noTypeLayer){\r\n        var layersToInfer = [];\r\n        if (noTypeLayer.layers){\r\n            for(var i = 0; i < noTypeLayer.layers.length; i++){\r\n                var layer = noTypeLayer.layers[i];\r\n                layer.options = noTypeLayer.options;\r\n                layersToInfer.push(layer);\r\n            }\r\n        } else {\r\n            layersToInfer.push(noTypeLayer);\r\n        }\r\n        for(var i = 0; i<layersToInfer.length; i++){\r\n           var layerToInfer = layersToInfer[i];\r\n           inferNoTypeLayer(layerToInfer, this).then((typedLayer) => {\r\n                console.log(\"Adding Layer \" + noTypeLayer._hashFromPython + \" \" +\r\n                    \"to map.\");\r\n                this.map.add(typedLayer);\r\n            }).catch((err) => {\r\n                this._displayErrorBox(\"Could not update layer. \" + err);\r\n                console.warn(\"Could not update layer\"); console.warn(err);\r\n            });\r\n       }\r\n    },\r\n\r\n    layers_to_remove_changed: function(){\r\n        try{\r\n            console.log(\"Called layer to remove changed...\");\r\n            var _layers_to_remove = this.model.get(\"_layers_to_remove\");\r\n            for(var i in _layers_to_remove){\r\n                var layerId = _layers_to_remove[i];\r\n                do {\r\n                    var layer = this.map.findLayerById(layerId);\r\n                    var layerExistsOnMap = Boolean(layer);\r\n                    if(layerExistsOnMap){\r\n                        console.log(\"Attempting to remove layer\" + layer.id);\r\n                        this.map.remove(layer);\r\n                    }\r\n                } while(layerExistsOnMap);\r\n            }\r\n        } catch(err){\r\n            this._displayErrorBox(\"Error removing layer\");\r\n            console.warn(\"Error removing layer\"); console.warn(err);\r\n        }\r\n    },\r\n\r\n    hide_mode_switch_changed: function(){\r\n        //NOTE: it is only possible to remove this element\r\n        //To 'recreate', you must instantiate a whole new object\r\n        if(this.model.get(\"hide_mode_switch\")){\r\n            console.log(\"Removing the mode switch...\");\r\n            this.elements.switchButton.remove();\r\n        }\r\n    },\r\n\r\n    getGraphicsLayer: function(GraphicsLayer){\r\n        ///All graphics are drawn on 1 layer: return it if it's been made,\r\n        ///Make it if it hasn't\r\n        var graphicsLayer = this.map.findLayerById(graphicsLayerId);\r\n        if(typeof graphicsLayer === \"undefined\"){\r\n            graphicsLayer = new GraphicsLayer({\r\n                id: graphicsLayerId});\r\n            this.map.add(graphicsLayer);\r\n        }\r\n        return graphicsLayer\r\n    },\r\n\r\n    draw_these_graphics_on_widget_load: function(){\r\n        var graphics = this.model.get('_draw_these_graphics_on_widget_load');\r\n        console.log(\"Drawing these layers on load... \");\r\n        console.log(graphics);\r\n        for(var i in graphics){\r\n            var graphic_json = graphics[i];\r\n            this.add_graphic(graphic_json);\r\n        }\r\n    },\r\n\r\n    graphics_changed: function(){\r\n        var graphic_json = this.model.get(\"_add_this_graphic\");\r\n        if(Object.keys(graphic_json).length !== 0){\r\n            this.add_graphic(graphic_json);\r\n       }\r\n    },\r\n\r\n    add_graphic: function(graphic_json){\r\n        esriLoader.loadModules(['esri/layers/GraphicsLayer',\r\n                                'esri/Graphic',\r\n                                'esri/geometry/Geometry',\r\n                                'esri/symbols/support/jsonUtils'],\r\n        options).then(([GraphicsLayer,\r\n                        Graphic,\r\n                        Geometry,\r\n                        symbolJsonUtils]) => {\r\n            var gfx = new Graphic(graphic_json);\r\n            if(gfx.symbol == null) {\r\n                console.log(gfx.geometry);\r\n                if (/polyline/i.test(gfx.geometry.type)) {\r\n                    gfx.symbol = { type: 'simple-line' }\r\n                } else if (/polygon/i.test(gfx.geometry.type)) {\r\n                    gfx.symbol = { type: \"simple-fill\" };\r\n                } else if (/point/i.test(gfx.geometry.type)) {\r\n                    gfx.symbol = { type: 'simple-marker' }\r\n                } else if (/multipoint/i.test(gfx.geometry.type)) {\r\n                    gfx.symbol = { type: 'simple-marker' }\r\n                }\r\n            }\r\n            if('symbol' in graphic_json){\r\n                var symbol = symbolJsonUtils.fromJSON(graphic_json.symbol);\r\n                if(symbol != null){\r\n                    gfx.symbol = symbol\r\n                }\r\n            }\r\n            var graphicsLayer = this.getGraphicsLayer(GraphicsLayer);\r\n            graphicsLayer.add(gfx);\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error on updating graphics.\");\r\n            console.warn(\"Error on updating graphics\"); console.warn(err);\r\n        });\r\n    },\r\n\r\n    interactive_draw_shape: function(){\r\n        esriLoader.loadModules(['esri/widgets/Sketch/SketchViewModel',\r\n                                'esri/layers/GraphicsLayer',\r\n                                'esri/Graphic'],\r\n        options).then(([SketchViewModel,\r\n                        GraphicsLayer,\r\n                        Graphic]) => {\r\n            console.log(\"Entering interactive draw shape mode.\");\r\n            var shape = this.model.get(\"_trigger_interactive_draw_mode_for\");\r\n            if(shape){\r\n                var view = this.activeView;\r\n                var graphicsLayer = this.getGraphicsLayer(GraphicsLayer);\r\n                var sketch = new SketchViewModel({\r\n                  layer: graphicsLayer,\r\n                  view: view,\r\n                });\r\n                sketch.create(shape);\r\n                sketch.on(\"create\", (event) => {\r\n                    if(event.state == \"complete\"){\r\n                        this.send({ event: 'draw-end',\r\n                                    message: event.graphic.geometry.toJSON() });\r\n                    }\r\n                });\r\n            }\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error on drawing interactive shape\");\r\n            console.warn(\"Error on interactive shape\"); console.warn(err);\r\n        });\r\n   },\r\n\r\n    trigger_jlab_window_changed: function(){\r\n        var args = this.model.get(\"_trigger_new_jlab_window_with_args\");\r\n        console.log(\"new_jlab_window triggered with:\");\r\n        console.log(args);\r\n        if(Object.keys(args).length !== 0){\r\n            this.move_to_new_jlab_window(args)\r\n        }\r\n    },\r\n\r\n    move_to_new_jlab_window: function(args){\r\n        if(config.JupyterTarget !== \"lab\"){\r\n            this._displayErrorBox(\"Can only move to new window in a \" + \r\n                                  \"JupyterLab env\");\r\n            console.warn(\"Can't move to new window: JupyterTarget = \" + \r\n                          config.JupyterTarget);\r\n            return\r\n        }\r\n        console.log(\"Attempting to move map to new jlab window...\");\r\n        var childMapElement = this.el.childNodes[0];\r\n        console.log(childMapElement);\r\n        if(childMapElement != null){\r\n            //Element is currently in the notebook; so, move it to a new window\r\n            var window_title = args.title;\r\n            var tab_mode;\r\n            if (\"tab_mode\" in args){\r\n                tab_mode = args.tab_mode\r\n            } else {\r\n                tab_mode = this.model.get(\"tab_mode\"); }\r\n            window.newJLabWindow({title: window_title,\r\n                                  element: childMapElement,\r\n                                  tab_mode: tab_mode});\r\n            //hide the icon when you're in seperate window mode\r\n            this.elements.newWindowButton.src = images.toOriginalWindowEncoded;\r\n            //Store the previous height of the element\r\n            this.prevElementHeight = this.el.style.height;\r\n            this.el.style.height = \"0px\";\r\n        } else {\r\n            //element is currently in a new window (or is somewhere else)\r\n            //So, move it back to the notebook\r\n            var activeMapElement = document.getElementById(\r\n                this.elements.viewdivElement.id);\r\n            window.closeJLabWindow({element: activeMapElement});\r\n            this.elements.newWindowButton.src = images.toNewWindowEncoded;\r\n            this.el.style.height = this.prevElementHeight;\r\n        }\r\n    },\r\n\r\n    portal_token_changed: function(){\r\n    try{\r\n        var _portal_token = this.model.get(\"_portal_token\");\r\n        if(_portal_token){\r\n            console.log(\"updating _portal_token...\");\r\n            this._portalToken = _portal_token;\r\n            globalTokenLookup[this.uuid] = _portal_token;\r\n            this.model.set(\"_portal_token\", \"\");\r\n            this.model.save_changes();\r\n        }\r\n    } catch (err) {\r\n        this._displayErrorBox(\"Error storing token.\");\r\n        console.warn(\"Error storing token.\"); console.warn(err);\r\n    }\r\n    },\r\n\r\n    get_portal_token: function(){\r\n        // The portal token doesn't exist in the model for long due to security\r\n        // concerns: this function should return the string of any token,\r\n        // regardless of what state the token transfer is in\r\n        if(this._portalToken){\r\n            return this._portalToken;\r\n        } else if (this.uuid in globalTokenLookup){\r\n            return globalTokenLookup[this.uuid];\r\n        } else {\r\n            return this.model.get(\"_portal_token\");\r\n        }\r\n    },\r\n\r\n    authenticate_to_portal: function(){\r\n        ///Given all relevant information in the model, attempt to authenticate\r\n        ///to the portal, then return the portal. Then, resolve the portal obj\r\n        ///On any error, reject the Promise\r\n        ///The _portal_token should be deleted and set to this before this\r\n        ///function is called if you're planning on using auth\r\n    return new Promise((resolve, reject) => {\r\n        esriLoader.loadModules(['esri/config',\r\n                                'esri/identity/ServerInfo',\r\n                                'esri/identity/IdentityManager',\r\n                                'esri/portal/Portal'],\r\n        options).then(([esriConfig,\r\n                        ServerInfo,\r\n                        IdentityManager,\r\n                        Portal]) => {\r\n            var _auth_mode = this.model.get(\"_auth_mode\");\r\n            if(('_portal' in this) && (this._portal.loaded)){\r\n                //If we've previously set up a portal & its loaded, resolve it\r\n                resolve(this._portal);\r\n            } else if(_auth_mode.toLowerCase() === \"anonymous\"){\r\n                //If we specified an anonymous connection, load it and resolve\r\n                var _portal_url = this.model.get(\"_portal_url\");\r\n                if(_portal_url !== \"\"){\r\n                    esriConfig.portalUrl = _portal_url;\r\n                }\r\n                this._portal = new Portal({authMode: 'anonymous'});\r\n                this._portal.load().then(() => {\r\n                    resolve(this._portal);\r\n                }).catch((err) => {\r\n                    reject(err);\r\n                });\r\n            } else if (_auth_mode.toLowerCase() === \"tokenbased\"){\r\n                //If we specified token based authentication, attempt to resolve it\r\n                var _portal_url = this.model.get(\"_portal_url\");\r\n                var _portal_sharing_rest_url = this.model.get(\"_portal_sharing_rest_url\");\r\n                var _portal_token = this.get_portal_token();\r\n                if(!(_portal_url && _portal_sharing_rest_url && _portal_token)){\r\n                    var rejMsg = \"_portal_url, _portal_sharing_rest_url, and _portal_token \" + \r\n                        \"must be specified to authenticate in 'tokenBased' auth mode. \" +\r\n                        \"_portal_url = \" + _portal_url + \", _portal_sharing_rest_url = \" +\r\n                        _portal_sharing_rest_url + \", _portal_token = \" + this._portalToken;\r\n                    reject(rejMsg);\r\n                } else {\r\n                    var serverInfo = new ServerInfo();\r\n                    serverInfo.server = _portal_sharing_rest_url;\r\n                    serverInfo.tokenServiceUrl = _portal_sharing_rest_url + 'generateToken';\r\n                    IdentityManager.registerServers([serverInfo]);\r\n                    IdentityManager.registerToken({\"server\": _portal_sharing_rest_url,\r\n                                                  \"userId\": this.model.get(\"_username\"),\r\n                                                  \"token\": _portal_token});\r\n                    //Needed for IWA authentication in DSX mode - dv\r\n                    esriConfig.request.trustedServers.push(_portal_url);\r\n                    console.log(\"esriConfig.request.trustedServers = \");\r\n                    console.log(esriConfig.request.trustedServers);\r\n                    //End IWA workaround section\r\n                    this._portal = new Portal({\r\n                        url: _portal_url});\r\n                    this._portal.load().then(() => {\r\n                        resolve(this._portal);\r\n                    }).catch((err) => {\r\n                        reject(err);\r\n                    });\r\n                }\r\n            } else if (_auth_mode.toLowerCase() === \"prompt\"){\r\n                var _portal_url = this.model.get(\"_portal_url\");\r\n                if(_portal_url !== \"\"){\r\n                    esriConfig.portalUrl = _portal_url;\r\n                }\r\n                this._portal = new Portal({\r\n                    authMode: 'immediate',\r\n                    allSSL: false,\r\n                    canSignInArcGIS: true,\r\n                    canSignInIDP: true,\r\n                    authorizedCrossOriginDomains: [esriConfig.portalUrl,]});\r\n                this._portal.load().then(() => {\r\n                    resolve(this._portal);\r\n                }).catch((err) => {\r\n                    reject(err);\r\n                });\r\n             } else {\r\n                reject(\"You must specify the '_auth_mode' model variable to \" + \r\n                       \"either 'anonymous', 'tokenbased', or 'prompt'\");\r\n            }\r\n        }).catch((err) => {\r\n                reject(err);\r\n            });\r\n    })},\r\n\r\n    js_cdn_changed: function() {\r\n        var fallback_cdn = this.model.get(\"_js_cdn_override\");\r\n        if(fallback_cdn !== \"\"){\r\n            configureCDN(config, fallback_cdn);\r\n            console.log(\"CDN changed: new config = \");\r\n            console.log(config);\r\n            options = config.EsriLoaderOptions;\r\n            this._check_js_api_version_loaded(fallback_cdn);\r\n            css_url = fallback_cdn + \"esri/css/main.css\"\r\n            if(config.JupyterTarget === \"notebook\"){\r\n                esriLoader.setRequireJSConfig(config.BaseRequireJSConfig);\r\n                //TODO: remove this jquery for notebook css adding\r\n                $('head').append($('<link rel=\"stylesheet\" type=\"text/css\" />'\r\n                    ).attr('href', css_url));\r\n            } else if(config.JupyterTarget === \"lab\"){\r\n                esriLoader.loadCss(css_url)\r\n            }\r\n            esriLoader.loadModules(['esri/config'],\r\n            options).then(([esriConfig,]) => {\r\n                esriConfig.request.corsEnabledServers.push(fallback_cdn)\r\n            }).catch((err) => {\r\n                console.log(\"Error while setting fallback cdn\");\r\n                console.log(err);\r\n            });\r\n        }\r\n    },\r\n\r\n    legend_prop_changed: function() {\r\n        try{\r\n            console.log(\"legend changed\");\r\n            var widgetCorner = \"bottom-right\";\r\n            var legendProp = this.model.get(\"legend\");\r\n            if(legendProp){\r\n                this.activeView.ui.empty(widgetCorner);\r\n                this._legend.view = this.activeView;\r\n                this.activeView.ui.add(this._legend, widgetCorner);\r\n            } else {\r\n                this.activeView.ui.empty(widgetCorner);\r\n            }\r\n        } catch(err) {\r\n            console.log(\"Error while trying to show legend.\");\r\n            console.log(err);\r\n        }\r\n    },\r\n\r\n    time_slider_prop_changed: function(){\r\n        try{\r\n            console.log(\"time slider changed\");\r\n            var widgetCorner = \"bottom-left\";\r\n            var timeSliderProp = this.model.get(\"time_slider\");\r\n            if(timeSliderProp){\r\n                this.activeView.ui.empty(widgetCorner);\r\n                this._time_slider.view = this.activeView;\r\n                this.activeView.ui.add(this._time_slider, widgetCorner);\r\n            } else {\r\n                this.activeView.ui.empty(widgetCorner);}\r\n        } catch(err) {\r\n            this._displayErrorBox(\"Error while updating time slider\");\r\n            console.warn(\"Error while trying to show time slider\");\r\n            console.warn(err);}\r\n    },\r\n\r\n    time_mode_changed: function(){\r\n        try{\r\n            var timeSlider = this.model.get(\"time_slider\");\r\n            if(timeSlider){\r\n                console.log(\"time mode changed\");\r\n                var timeMode = this.model.get(\"time_mode\");\r\n                var values = this._time_slider.values;\r\n                this._time_slider.mode = timeMode;\r\n                if(values.length > 0){\r\n                    if(timeMode === \"instant\"){\r\n                        this._time_slider.values = [values[0],];}\r\n                    if(timeMode === \"time-window\"){\r\n                        if(values.length == 1){\r\n                            this._time_slider.values = [\r\n                                values[0],\r\n                                values[0]];}}\r\n                    if(timeMode === \"cumulative-from-start\"){\r\n                        this._time_slider.values = [values[0],];}\r\n                    if(timeMode === \"cumulative-from-end\"){\r\n                        this._time_slider.values = [values[0],];}}}}\r\n        catch(err){\r\n            this._displayErrorBox(\"Error while updating time mode\");\r\n            console.warn(\"Error while trying updating time mode\"); console.warn(err);}\r\n    },\r\n\r\n    time_slider_values_changed: function(values){\r\n        if(values.length == 2){\r\n            this.model.set(\"_readonly_start_time\", values[0].toISOString());\r\n            this.model.set(\"_readonly_end_time\", values[1].toISOString());}\r\n        if(values.length == 1){\r\n            this.model.set(\"_readonly_start_time\", values[0].toISOString());}\r\n        this.model.save_changes();\r\n    },\r\n\r\n    time_info_changed: function(){\r\n    esriLoader.loadModules(['esri/TimeExtent',\r\n                            'esri/TimeInterval'],\r\n    options).then(([TimeExtent, TimeInterval]) => {\r\n        var timeInfo = this.model.get(\"_time_info\");\r\n        console.log(\"Time Info changed\");\r\n        console.log(timeInfo);\r\n        if('time_extent' in timeInfo){\r\n            var start = new Date(timeInfo.time_extent[0]);\r\n            var end = new Date(timeInfo.time_extent[1]);\r\n            this._time_slider.fullTimeExtent = new TimeExtent({\r\n                                               start: start,\r\n                                               end: end});}\r\n        var intervalValue = 1;\r\n        var intervalUnit = 'milliseconds';\r\n        if('interval' in timeInfo){\r\n            intervalValue = timeInfo.interval;}\r\n        if('unit' in timeInfo){\r\n            intervalUnit = timeInfo.unit;}\r\n        this._time_slider.stops = {\"interval\" : new TimeInterval({\r\n            value: intervalValue,\r\n            unit: intervalUnit})};\r\n    }).catch((err) => {\r\n        this._displayErrorBox(\"Error while changing the time info\");\r\n        console.warn(\"Error while trying to change the time info\");\r\n        console.warn(err);});\r\n    },\r\n\r\n    start_time_changed: function(){\r\n        try{\r\n            console.log(\"start time changed\");\r\n            var startTimeStr = this.model.get(\"_writeonly_start_time\");\r\n            var startTime = new Date(startTimeStr);\r\n            if(this._time_slider.values.length == 1){\r\n                this._time_slider.values = [startTime,];}\r\n            if(this._time_slider.values.length == 2){\r\n                var endTime = this._time_slider.values[1];\r\n                this._time_slider.values = [startTime, endTime];}}\r\n        catch(err){\r\n            this._displayErrorBox(\"Error while changing `start_time`\");\r\n            console.warn(\"Error while changing start_time\");\r\n            console.warn(err);}\r\n    },\r\n\r\n    end_time_changed: function(){\r\n        try{\r\n            console.log(\"end time changed\");\r\n            var endTimeStr = this.model.get(\"_writeonly_end_time\");\r\n            var endTime = new Date(endTimeStr);\r\n            var startTime = this._time_slider.values[0];\r\n            this._time_slider.values = [startTime, endTime];}\r\n        catch(err){\r\n            this._displayErrorBox(\"Error while changing `end_time`\");\r\n            console.warn(\"Error while changing `end_time`\");\r\n            console.warn(err);}\r\n    },\r\n\r\n    // Start screenshot section\r\n    _trigger_screenshot_with_args_changed: function() {\r\n        var args = this.model.get('_trigger_screenshot_with_args');\r\n        console.log(\"Triggering Screenshot with args \");\r\n        console.log(args);\r\n        modelStrsToSendTo = [];\r\n        if(args.set_as_preview){\r\n            modelStrsToSendTo.push('_preview_screenshot_callback_resp');\r\n        }\r\n        if(args.output_in_cell){\r\n            modelStrsToSendTo.push(\"_cell_output_screenshot_callback_resp\");\r\n        }\r\n        if(args.file_path){\r\n            modelStrsToSendTo.push(\"_file_output_screenshot_callback_resp\");\r\n        }\r\n        this._capture_screenshot_send_to(modelStrsToSendTo);\r\n    },\r\n\r\n    _capture_screenshot_send_to: function(modelStrsToSendTo) {\r\n        var mode = this.model.get('mode');\r\n        var funcToCall = \"\";\r\n        if(mode === \"3D\"){\r\n            funcToCall = this._get_3d_screenshot;\r\n        } else if(mode === \"2D\"){\r\n            funcToCall = this._get_2d_screenshot;\r\n        }\r\n        funcToCall(this).then((base64Str) => {\r\n            for(var i in modelStrsToSendTo){\r\n                var modelStr = modelStrsToSendTo[i];\r\n                this.model.set(modelStr, base64Str);\r\n            }\r\n            this.touch();\r\n        }).catch((err) => {\r\n            console.log(\"Could not take screenshot\"); console.log(err);\r\n            this._displayErrorBox(\"Could not take screenshot.\");\r\n            for(var i in modelStrsToSendTo){\r\n                console.log(\"sending \" + modelStr + \" to \");\r\n                var modelStr = modelStrsToSendTo[i];\r\n                this.model.set(modelStr, images.screenshotErrorEncoded);\r\n            }\r\n            this.touch();\r\n        });\r\n    },\r\n\r\n    _get_2d_screenshot: function(widget_inst) {\r\n        return new Promise((resolve, reject) => {\r\n            widget_inst._MapView.takeScreenshot({format:\"png\"}).then((screenshot) => {\r\n                resolve(screenshot.dataUrl);\r\n            }).catch((err) => {\r\n                reject(err);\r\n            });\r\n        });\r\n    },\r\n\r\n    _get_3d_screenshot: function(widget_inst) {\r\n        return new Promise((resolve, reject) => {\r\n            widget_inst._SceneView.takeScreenshot({format:\"png\"}).then((screenshot) => {\r\n                resolve(screenshot.dataUrl);\r\n            }).catch((err) => {\r\n                reject(err);\r\n           });\r\n        });\r\n    },\r\n\r\n    // End screenshot section\r\n\r\n    // Start image overlay section\r\n\r\n    overlay_these_images_on_widget_load: function(){\r\n        var images = this.model.get(\"_overlay_these_images_on_widget_load\");\r\n        for(var i=0; i<images.length; i++){\r\n            var image = images[i];\r\n            this.overlay_this_image(image);\r\n        }\r\n    },\r\n\r\n    overlay_image_changed: function(){\r\n        var image = this.model.get(\"_overlay_this_image\");\r\n        this.overlay_this_image(image);\r\n    },\r\n\r\n    getActiveImageOverlayLayer: function(ImageOverlayLayer){\r\n        ///All graphics are drawn on 1 layer: return it if it's been made,\r\n        ///Make it if it hasn't\r\n        var imageOverlayLayer = this.map.findLayerById(imageOverlayLayerId);\r\n        if(typeof imageOverlayLayer === \"undefined\"){\r\n            imageOverlayLayer = new ImageOverlayLayer({\r\n                id: imageOverlayLayerId});\r\n            this.map.add(imageOverlayLayer);}\r\n        return imageOverlayLayer;\r\n    },\r\n\r\n    overlay_this_image: function(image){\r\n    if(Object.keys(image).length !== 0){\r\n        if(config.JupyterTarget === \"lab\"){\r\n            //JupyterLab handles URLs differently than classic notebook server.\r\n            //Change the image path to the full path prepended by `/tree/`\r\n            //See: https://jupyterlab.readthedocs.io/en/stable/user/urls.html\r\n            //TODO: consider using `ContentsManager` from `@jupyterlab/services`\r\n            //Ref: https://jupyterlab.github.io/jupyterlab/services/index.html\r\n            var nbPath = this.model.widget_manager.context.session.path;\r\n            var nbName = this.model.widget_manager.context.session.name;\r\n            var nbDir = nbPath.substring(0, nbPath.lastIndexOf(nbName));\r\n            image.src = \"/tree/\" + nbDir + image.src;}\r\n\r\n        getImageOverlayLayerType().then((ImageOverlayLayer) => {\r\n            var imageOverlayLayer = this.getActiveImageOverlayLayer(ImageOverlayLayer);\r\n            imageOverlayLayer.tryOverlayImage(image).catch((err) => {\r\n                if(err.message.includes(\"NetworkError\")){\r\n                    this._displayErrorBox(\"Error overlaying image (uhandled \"+\r\n                        \"NetworkError). You probably specified an image URL \"+\r\n                        \"that violate browser security rules (CORs, etc).\");\r\n                } else if(err.name.includes(\"BadHTTPStatusError\")) {\r\n                    this._displayErrorBox(\"Error overlaying image (URL \" + \r\n                        \"return status \" + err.status + \"). \");\r\n                } else {\r\n                    this._displayErrorBox(\"Error on overlaying image.\");}\r\n                console.warn(\"Error on overlaying image\"); console.warn(err);\r\n            });\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error getting ImageOverlayLayer type:\");\r\n            console.log(\"Error getting ImageOverlayLayer type\"); console.log(err);\r\n        });\r\n        }\r\n    },\r\n\r\n    image_overlays_to_remove_changed: function(){\r\n        var overlaysToRemove = this.model.get('_image_overlays_to_remove')\r\n        getImageOverlayLayerType().then((ImageOverlayLayer) => {\r\n            var imageOverlayLayer = this.getActiveImageOverlayLayer(ImageOverlayLayer);\r\n            imageOverlayLayer.tryRemoveImageOverlays(overlaysToRemove);\r\n        }).catch((err) => {\r\n            this._displayErrorBox(\"Error getting ImageOverlayLayer type:\");\r\n            console.log(\"Error getting ImageOverlayLayer type:\"); console.log(err);\r\n        });\r\n    },\r\n\r\n    // End image overlay section\r\n\r\n    _check_js_api_version_loaded: function(fallback_cdn){\r\n        this._httpGetAsync(fallback_cdn).then((response) => {\r\n            //TODO: find better parsing logic for finding out what version\r\n            var lines = response.split(\"\\n\");\r\n            var copyrightLine = null; //copyright.txt line link contains version #\r\n            for(var i = 0; i < lines.length; i++){\r\n                var line = lines[i];\r\n                if((line.indexOf(\"js.arcgis.com\") !== -1) && \r\n                   (line.indexOf(\"copyright.txt\") !== -1)){\r\n                    copyrightLine = line;\r\n                    break;\r\n                }\r\n            }\r\n            if(copyrightLine !== null){\r\n                console.log(\"Copyright line = '\" + copyrightLine + \"'\");\r\n                var versionNum = copyrightLine.split(\r\n                    \"js.arcgis.com/\")[1].split(\"/esri\")[0];\r\n                if (versionNum < config.minJSAPIVersion){\r\n                    console.warn(\"JS API \" + versionNum + \" < \" + config.minJSAPIVersion);\r\n                    this._displayErrorBox(\"Warning: the ArcGIS API for JavaScript \" + \r\n                        \"being loaded at \" + fallback_cdn + \" does not appear to be \" +\r\n                        \">=\" + config.minJSAPIVersion + \". Widget may not function \" + \r\n                        \"properly.\", browser_console_message=false);\r\n                }\r\n            } else {\r\n                console.warn(\"Could not infer javascript version\");\r\n                this._displayErrorBox(\"Warning: Could not infer version of any \" +\r\n                    \"loaded ArcGIS API for JavaScript. Widget may not function \" +\r\n                    \"properly.\", browser_console_message=false);\r\n            }\r\n        }).catch((err) => {\r\n            console.log(\"Could not reach the fallback cdn...\");\r\n            console.log(err);\r\n        });\r\n    },\r\n\r\n    _httpGetAsync : function(theUrl){\r\n        return new Promise((resolve, reject) => {\r\n            fetch(theUrl, {mode: 'cors'}).then((response) => {\r\n                if (response.status >= 200 && response.status < 300){\r\n                    response.text().then((data) => {\r\n                        resolve(data);\r\n                    }).catch((err) => {\r\n                        reject(err);\r\n                    });\r\n                } else {\r\n                    reject(\"HTTP request on \" + theUrl + \r\n                           \" returned code \" + status);\r\n                }\r\n            })\r\n        })\r\n    },\r\n});\r\n\r\nmodule.exports = ArcGISMapIPyWidgetView;\r\n\r\n","/*All elements that either contain the widget or add onto it*/\r\nvar loadingProgress = require(\"./loading-progress-display\");\r\nvar config = require(\"config\");\r\nvar images = require(\"../images/images\");\r\n\r\nvar createElements = function(uuid){\r\n    //The parent 'viewElement' that contains the map, info, etc.\r\n    var viewdivElement = document.createElement(\"div\");\r\n    viewdivElement.className = \"viewDiv\";\r\n    viewdivElement.id = viewdivElement.className + uuid;\r\n    viewdivElement.style.padding = \"0\";\r\n    viewdivElement.style.margin = \"0\";\r\n    viewdivElement.style.height = \"100%\";\r\n    viewdivElement.style.width = \"100%\";\r\n    viewdivElement.style.position = \"relative\";\r\n\r\n    //The information element (note: I don't see this on the widget)\r\n    var infodivElement = document.createElement(\"div\");\r\n    infodivElement.className = \"infoDiv\";\r\n    infodivElement.id = infodivElement.className + uuid;\r\n    infodivElement.style.position = \"absolute\";\r\n    infodivElement.style.top = \"15px\";\r\n    infodivElement.style.left = \"60px\";\r\n\r\n    //The button that allows you to switch from 2D to 3D\r\n    var switchButton   = document.createElement(\"input\");\r\n    switchButton.classList.add('switchButtonId');\r\n    switchButton.id = 'switchButton' + uuid;\r\n    switchButton.type = \"image\";\r\n    switchButton.classList.add(\"esri-component\");\r\n    switchButton.classList.add(\"esri-widget--button\");\r\n    switchButton.classList.add(\"esri-widget\"); \r\n    switchButton.classList.add(\"esri-interactive\");\r\n    switchButton.style.boxShadow = \"rgba(0, 0, 0, 0.3) 0px 1px 2px\";\r\n    switchButton.style.border = \"none\";\r\n    switchButton.style.float = \"left\";\r\n    switchButton.style.marginRight = \"13px\";\r\n\r\n    if(config.JupyterTarget === \"lab\"){\r\n        var newWindowButton   = document.createElement(\"input\");\r\n        newWindowButton.classList.add('newWindowButton');\r\n        newWindowButton.id = 'newWindowButtonId' + uuid;\r\n        newWindowButton.type = \"image\";\r\n        newWindowButton.src = images.toNewWindowEncoded;\r\n        newWindowButton.classList.add(\"esri-component\");\r\n        newWindowButton.classList.add(\"esri-widget--button\");\r\n        newWindowButton.classList.add(\"esri-widget\"); \r\n        newWindowButton.classList.add(\"esri-interactive\");\r\n        newWindowButton.style.boxShadow = \"rgba(0, 0, 0, 0.3) 0px 1px 2px\";\r\n        newWindowButton.style.fontFamily ='CalciteWebCoreIcons';\r\n        newWindowButton.style.border = \"none\";\r\n        newWindowButton.style.float = \"right\";\r\n        newWindowButton.style.marginRight = \"13px\"; \r\n\r\n        newWindowButton.style.width = \"32px\";\r\n        newWindowButton.style.height = \"32px\";\r\n        newWindowButton.style.textAlign = \"center\";\r\n        newWindowButton.style.margin = \"0 10px 10px 0\";\r\n        newWindowButton.style.fontSize = \"125%\";\r\n\r\n    }\r\n    //The loading text element\r\n    var loadingText = loadingProgress.element;\r\n    loadingText.className = \"loadingText\";\r\n    loadingText.id = loadingText.className + uuid;\r\n\r\n    //A generic information text box that shows error info (manually styled to match map widget)\r\n    var errorTextBox = document.createElement(\"div\");\r\n    errorTextBox.className = 'errorTextDiv';\r\n    errorTextBox.id = errorTextBox.className + uuid;\r\n    errorTextBox.style.position = \"absolute\";\r\n    errorTextBox.style.right = \"5px\";\r\n    errorTextBox.style.top = \"5px\";\r\n    errorTextBox.style.width = \"25%\";\r\n    errorTextBox.style.color = \"#6f6f6f\"\r\n    errorTextBox.style.backgroundColor = \"#ffffff\";\r\n    errorTextBox.style.boxShadow = \"rgba(0, 0, 0, 0.3) 0px 1px 2px\";\r\n    errorTextBox.style.fontFamily = \"sans-serif\";\r\n    errorTextBox.style.fontWeight = \"400\";\r\n    errorTextBox.style.wordWrap = \"break-word\";\r\n    var errorCloseButton = document.createElement(\"div\");\r\n    errorCloseButton.className = \"errorCloseButton\";\r\n    errorCloseButton.id = errorCloseButton.className + uuid;\r\n    errorCloseButton.style.position = \"absolute\";\r\n    errorCloseButton.style.top = \"3px\";\r\n    errorCloseButton.style.right = \"9px\";\r\n    errorCloseButton.style.color = \"#ababab\";\r\n    errorCloseButton.style.fontFamily = \"sans-serif\";\r\n    errorCloseButton.style.fontWeight = \"400\";\r\n    errorTextBox.appendChild(errorCloseButton);\r\n    var clearAllText = function() {\r\n        errorTextBox.textContent = \"\";\r\n        errorCloseButton.textContent = \"\";\r\n        errorTextBox.style.padding = \"0px\";\r\n    };\r\n    errorTextBox.onclick = clearAllText;\r\n    errorCloseButton.onclick = clearAllText;\r\n\r\n    //The actual map element\r\n    var mapElement     = document.createElement(\"div\");\r\n    mapElement.className = \"mapElement\";\r\n    mapElement.id = mapElement.className + uuid;\r\n    mapElement.style.height = \"100%\";\r\n    mapElement.style.width = \"100%\";\r\n\r\n    //Establish parent/child relationships\r\n    viewdivElement.appendChild(loadingText);\r\n    viewdivElement.appendChild(mapElement);\r\n    viewdivElement.appendChild(infodivElement);\r\n    viewdivElement.appendChild(errorTextBox);\r\n    viewdivElement.appendChild(errorCloseButton);\r\n\r\n    return {\r\n        viewdivElement,\r\n        infodivElement,\r\n        mapElement,\r\n        switchButton,\r\n        errorTextBox,\r\n        errorCloseButton,\r\n        loadingText,\r\n        newWindowButton\r\n    }\r\n}\r\n\r\nmodule.exports = createElements;\r\n","var CdnUrl = \"https://js.arcgis.com/4.19/\";\r\n\r\nvar CdnMainCssUrl = CdnUrl + \"esri/css/main.css\";\r\n\r\nvar EsriLoaderOptions = {\r\n    url: CdnUrl,\r\n    dojoConfig: {\r\n        has: {\r\n            \"esri-featurelayer-webgl\": 1\r\n        }\r\n    }\r\n}\r\n\r\nvar minJSAPIVersion = \"4.19\";\r\n\r\nvar config = {\r\n    CdnUrl,\r\n    CdnMainCssUrl,\r\n    EsriLoaderOptions,\r\n    minJSAPIVersion\r\n};\r\n\r\nmodule.exports = config;\r\n","//We want to alert the user using no esri-specific stylings or code, incase\r\n//esri code failed to load\r\nvar config = require(\"config\");\r\n\r\nvar displayPureJSErrorBox = function(msg, elements){\r\n    elements.errorTextBox.textContent = msg;\r\n    elements.errorCloseButton.textContent = \"✕\";\r\n    elements.errorTextBox.style.padding = \"10px\";\r\n}\r\n\r\nmodule.exports = displayPureJSErrorBox;\r\n","var getEsriLoader = require(\"../loaders/get-esri-loader\");\r\nvar inferRenderer = require(\"../renderer-utils/infer-renderer\");\r\nvar rendererTypesUtil = require(\"../renderer-utils/renderer-types-util\");\r\nvar createDefaultPopup = require(\"../popup-utils/create-default-popup\");\r\nvar config = require(\"config\");\r\nvar esriLoader = getEsriLoader(config);\r\nvar options = config.EsriLoaderOptions;\r\n\r\nvar _uuid4 = function() {\r\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, \r\n          function(c) {\r\n            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n            return v.toString(16);\r\n          });\r\n}\r\n\r\nvar inferNoTypeLayer = function(noTypeLayer, widget){\r\n    ///Take a generic object, constructs the correct layer type, returns\r\n    //a promise that let's you use the typedLayer this func constructs.\r\n    //For example: if you have an untyped layer (generic js object) like:\r\n    //var foo = {type: \"FeatureLayer\", url: \"https://arcgis.com/...\"}\r\n    //You can use this function like this:\r\n    //inferNoTypeLayer(foo).then((typedLayer) => \r\n    //    {//typedLayer is an instance of type FeatureLayer })\r\n    //TODO: put logic for major layer types here (i.e., FeatureLayer) in \r\n    //their own JS file\r\n    return new Promise(function(resolve, reject) {\r\n        esriLoader.loadModules(['esri/layers/ImageryLayer',\r\n                                'esri/layers/KMLLayer',\r\n                                'esri/layers/TileLayer',\r\n                                'esri/layers/MapImageLayer',\r\n                                'esri/layers/VectorTileLayer',\r\n                                'esri/layers/SceneLayer',\r\n                                'esri/layers/FeatureLayer',\r\n                                'esri/tasks/support/FeatureSet',\r\n                                'esri/layers/WMSLayer',\r\n                                'esri/layers/WMTSLayer',\r\n                                'esri/layers/GeoRSSLayer',\r\n                                'esri/layers/GeoJSONLayer',\r\n                                'esri/layers/CSVLayer',\r\n                                'esri/layers/support/RasterFunction',\r\n                                'esri/layers/support/MosaicRule',\r\n                                'esri/layers/PointCloudLayer',\r\n                                'esri/layers/IntegratedMeshLayer',\r\n                                'esri/layers/BuildingSceneLayer',\r\n                                'esri/layers/ImageryTileLayer'],\r\n        options).then(([ImageryLayer,\r\n                        KMLLayer,\r\n                        TileLayer,\r\n                        MapImageLayer,\r\n                        VectorTileLayer,\r\n                        SceneLayer,\r\n                        FeatureLayer,\r\n                        FeatureSet,\r\n                        WMSLayer,\r\n                        WMTSLayer,\r\n                        GeoRSSLayer,\r\n                        GeoJSONLayer,\r\n                        CSVLayer,\r\n                        RasterFunction,\r\n                        MosaicRule,\r\n                        PointCloudLayer,\r\n                        IntegratedMeshLayer,\r\n                        BuildingSceneLayer,\r\n                        ImageryTileLayer]) => {\r\n            if (noTypeLayer.type === \"ImageryLayer\"){\r\n                if (('capabilities' in noTypeLayer) &&\r\n                    (noTypeLayer.capabilities == \"tilesOnly\")){\r\n                        var typedLayer = new ImageryTileLayer(noTypeLayer.url);\r\n                        typedLayer.id = noTypeLayer._hashFromPython;\r\n                    }\r\n                else {\r\n                    var typedLayer = new ImageryLayer(noTypeLayer.url);\r\n                    typedLayer.id = noTypeLayer._hashFromPython;\r\n                    if (('options' in noTypeLayer) && \r\n                        ('imageServiceParameters' in noTypeLayer.options)){\r\n                        if('renderingRule' in noTypeLayer.options.imageServiceParameters){\r\n                            console.log(\"Applying rendering rule to imagery layer..\");\r\n                            var renderingRuleJSON = \r\n                                noTypeLayer.options.imageServiceParameters.renderingRule;\r\n                            var renderingRule = RasterFunction.fromJSON(renderingRuleJSON);\r\n                            typedLayer.renderingRule = renderingRule;}\r\n                        if('mosaicRule' in noTypeLayer.options.imageServiceParameters){\r\n                            console.log(\"Applying mosaic rule to imagery layer..\");\r\n                            var mosaicRuleJSON = \r\n                                noTypeLayer.options.imageServiceParameters.mosaicRule;\r\n                            var mosaicRule = MosaicRule.fromJSON(mosaicRuleJSON);\r\n                            typedLayer.mosaicRule = mosaicRule;}\r\n                        if ('raster' in noTypeLayer.options.imageServiceParameters) {\r\n                            var raster =\r\n                                noTypeLayer.options.imageServiceParameters.raster;\r\n                            var encodedRaster;\r\n                            if (typeof raster == \"string\") {\r\n                                encodedRaster = raster;\r\n                            }\r\n                            else {\r\n                                encodedRaster =\r\n                                    btoa(JSON.stringify(raster));\r\n                            }\r\n                            typedLayer.raster = encodedRaster;\r\n                        }\r\n                    }\r\n                }\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"KMLLayer\" || noTypeLayer.type == \"KML\") {\r\n                var typedLayer = new KMLLayer(noTypeLayer.url);\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if ((noTypeLayer.type == \"ArcGISTiledMapServiceLayer\") ||\r\n                     (noTypeLayer.type == \"TileLayer\")){\r\n                //Renamed in 4.X\r\n                var typedLayer = new TileLayer(noTypeLayer.url);\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if ((noTypeLayer.type == \"ArcGISDynamicMapServiceLayer\") ||\r\n                     (noTypeLayer.type == \"MapImageLayer\" )){\r\n                //renamed in 4.X\r\n                var typedLayer = new MapImageLayer(noTypeLayer.url);\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer)}\r\n            else if (noTypeLayer.type == \"VectorTileLayer\") {\r\n                var typedLayer = new VectorTileLayer(noTypeLayer.url);\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"WMS\"){\r\n                noTypeLayer.subLayers = [noTypeLayer.sublayers[0],];\r\n                delete noTypeLayer.type;\r\n                var typedLayer = new WMSLayer(noTypeLayer);\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"WebTiledLayer\"){\r\n                var typedLayer = new WMTSLayer({url : noTypeLayer.url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"GeoRSS\"){\r\n                var typedLayer = new GeoRSSLayer({url: noTypeLayer.url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"GeoJSON\"){\r\n                if(Object.keys(noTypeLayer.data).length !== 0){\r\n                    var blob = new Blob([JSON.stringify(noTypeLayer.data)],\r\n                                        {type: \"application/json\"});\r\n                    url = URL.createObjectURL(blob);}\r\n                else{\r\n                    url = noTypeLayer.url;}\r\n                var typedLayer = new GeoJSONLayer({url: url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                if(\"renderer\" in noTypeLayer){\r\n                    console.log(\"Using custom renderer for GeoJSON layer \" + \r\n                                typedLayer.id);\r\n                    inferRenderer(noTypeLayer.renderer.type,\r\n                                  noTypeLayer.renderer).then((renderer) => {\r\n                        typedLayer.renderer = renderer;\r\n                        resolve(typedLayer);\r\n                    }).catch((err) => {\r\n                        console.warn(\"Could not infer renderer for \" + \r\n                                     typedLayer.id);\r\n                        console.warn(err);\r\n                        resolve(typedLayer);\r\n                    });\r\n                } else {\r\n                    resolve(typedLayer);}}\r\n            else if (noTypeLayer.type == \"CSV\"){\r\n                inferRenderer(noTypeLayer.layerDefinition.drawingInfo.renderer.type,\r\n                    noTypeLayer.layerDefinition.drawingInfo.renderer).then((renderer) => {\r\n                    var typedLayer = new CSVLayer({url: noTypeLayer.url,\r\n                                                   renderer: renderer});\r\n                    typedLayer.id = noTypeLayer._hashFromPython;\r\n                    resolve(typedLayer);\r\n                }).catch((err) => {\r\n                    var typedLayer = new CSVLayer({url: noTypeLayer.url});\r\n                    typedLayer.id = noTypeLayer._hashFromPython;\r\n                    resolve(typedLayer);})}\r\n            else if (noTypeLayer.type == \"SceneLayer\"){\r\n                var typedLayer = new SceneLayer({url: noTypeLayer.url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"PointCloudLayer\"){\r\n                var typedLayer = new PointCloudLayer({url: noTypeLayer.url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"IntegratedMeshLayer\"){\r\n                var typedLayer = new IntegratedMeshLayer({url: noTypeLayer.url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if (noTypeLayer.type == \"BuildingSceneLayer\"){\r\n                var typedLayer = new BuildingSceneLayer({url: noTypeLayer.url});\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n                resolve(typedLayer);}\r\n            else if ((noTypeLayer.type == \"FeatureLayer\") ||\r\n                     (noTypeLayer.type == \"Feature Layer\")) {\r\n                //TODO: clean up this Feature layer stuff, seperate into new file\r\n                \r\n                //Create the base FeatureLayer\r\n                var unloadedLayer = new FeatureLayer(noTypeLayer.url, {\r\n                    \"outFields\": [\"*\"]});\r\n                unloadedLayer.id = noTypeLayer._hashFromPython;\r\n                unloadedLayer.load().then((layer) => {\r\n\r\n                    layer.popupTemplate = createDefaultPopup(layer);\r\n\r\n                    //Find out where any extra options are located, set them to lyr_options\r\n                    var lyr_options = {}\r\n                    if (noTypeLayer.options == null) {\r\n                        lyr_options = noTypeLayer;}\r\n                    else{\r\n                        lyr_options = noTypeLayer.options;}\r\n\r\n                    //Figure out if those options specify opacity and definition_expression\r\n                    if (lyr_options.opacity != null) {\r\n                        console.log('FeatureLayerOpacity:' + lyr_options.opacity);\r\n                        layer.opacity = lyr_options.opacity;}\r\n                    if (noTypeLayer.opacity != null) {\r\n                        layer.opacity = noTypeLayer.opacity;}\r\n                    if (lyr_options.definition_expression != null) {\r\n                        console.log(\"FeatureLayerDefinitionExpression:\");\r\n                        console.log(lyr_options.definition_expression);\r\n                        layer.definitionExpression = lyr_options.definition_expression;}\r\n                    if (noTypeLayer.definition_expression != null) {\r\n                        console.log(\"FeatureLayerDefinitionExpression:\");\r\n                        console.log(noTypeLayer.definition_expression);\r\n                        layer.definitionExpression = noTypeLayer.definition_expression;}\r\n\r\n                    //Figure out the renderer\r\n                    if (!lyr_options.renderer) {\r\n                        resolve(layer);\r\n                    } else { \r\n                        console.log(\"Specifying the FeatureLayer's custom renderer...\");\r\n                        var renderer = \"\";\r\n                        var rendererOptions = {};\r\n                        if(rendererTypesUtil.isSmartMapRenderer(lyr_options.renderer)){\r\n                            //TODO: Clean up this section, seperate out into own file\r\n                            rendererOptions = {layer: layer,\r\n                                               fieldName: lyr_options.field_name,\r\n                                               basemap: widget.model.get(\"basemap\"),\r\n                                               otherLayerOptions: lyr_options };\r\n                        } else {\r\n                            rendererOptions = lyr_options;\r\n                        }\r\n\r\n                        //At this point, lyr_options.renderer should be a string\r\n                        //If instead the user passed in the whole object as the \r\n                        //'renderer', assemble 'renderer' and 'rendererOptions' correctly\r\n                        if((typeof lyr_options.renderer != 'string') && \r\n                           (\"type\" in lyr_options.renderer)) {\r\n                            renderer = lyr_options.renderer.type;\r\n                            rendererOptions = lyr_options.renderer;\r\n                        } else {\r\n                            renderer = lyr_options.renderer;\r\n                        }\r\n\r\n                        inferRenderer(renderer, rendererOptions,\r\n                        widget).then((renderer) => {\r\n                            layer.renderer = renderer;\r\n                            resolve(layer);\r\n                        }).catch((err) => {\r\n                            console.warn(\"Error on inferring renderer.\");\r\n                            reject(err);})}}\r\n                ).catch((err) => {\r\n                    console.warn(\"Error when laoding Feature Layer\");\r\n                    reject(err);\r\n                })\r\n            } else if('featureSet' in noTypeLayer){\r\n                ///This is a catch for FeatureCollections\r\n                ///TODO: Seperate this out into its own file,\r\n                ///have the result of this stored in it's own widget model\r\n                console.log(\"Creating from FeatureCollection...\");\r\n\r\n                //convert all esriJSON to correct 4.X JSON via fromJSON\r\n                var layerDefinition = noTypeLayer.layerDefinition;\r\n                var esriJSONFS = noTypeLayer.featureSet;\r\n                esriJSONFS.spatialReference = layerDefinition.spatialReference;\r\n                esriJSONFS.fields = layerDefinition.fields;\r\n                var featureSet = FeatureSet.fromJSON(esriJSONFS);\r\n\r\n                //Assemble everything from the featureLayer BUT the renderer\r\n                var typedLayer = new FeatureLayer({\r\n                    title: _uuid4(), \r\n                    fields: featureSet.fields,\r\n                    objectIdField: layerDefinition.objectIdField,\r\n                    geometryType: featureSet.geometryType,\r\n                    spatialReference: featureSet.spatialReference,\r\n                    source: featureSet.features})\r\n                typedLayer.popupTemplate = createDefaultPopup(typedLayer);\r\n                typedLayer.id = noTypeLayer._hashFromPython;\r\n\r\n                //Get the correct renderer and rendererOptions to\r\n                if(\"renderer\" in noTypeLayer.options){\r\n                    renderer = noTypeLayer.options.renderer;\r\n                } else if(layerDefinition.drawingInfo.renderer.renderer === \"autocast\"){\r\n                    renderer = \"autocast\";\r\n                } else {\r\n                    renderer = layerDefinition.drawingInfo.renderer.type;\r\n                }\r\n                if(rendererTypesUtil.isSmartMapRenderer(renderer)){\r\n                    rendererOptions = { layer: typedLayer,\r\n                                        fieldName: noTypeLayer.options.field_name,\r\n                                        basemap: widget.model.get(\"basemap\"),\r\n                                        otherLayerOptions: noTypeLayer.options };\r\n                } else {\r\n                    rendererOptions = layerDefinition.drawingInfo.renderer;\r\n                }\r\n\r\n                //Infer the renderer from the above info, add to layer, resolve\r\n                inferRenderer(renderer, rendererOptions, widget).then(\r\n                (renderer) => {\r\n                        typedLayer.renderer = renderer;\r\n                        resolve(typedLayer);\r\n                    }).catch((err) => {\r\n                        console.warn(\"Error on inferring renderer.\");\r\n                        reject(err);});}\r\n            else{\r\n                console.warn('This layer type is not supported:');\r\n                console.warn(noTypeLayer);\r\n                reject(\"This layer type is not supported.\");}\r\n       }).catch((err) => {\r\n            reject(err);\r\n        });\r\n    });\r\n}\r\n\r\nmodule.exports = inferNoTypeLayer;\r\n","module.exports = require(\"esri-loader\");","/*\r\n  Copyright 2017 Esri\r\n  Licensed under the Apache License, Version 2.0 (the \"License\");\r\n  you may not use this file except in compliance with the License.\r\n  You may obtain a copy of the License at\r\n    http://www.apache.org/licenses/LICENSE-2.0\r\n  Unless required by applicable law or agreed to in writing, software\r\n  distributed under the License is distributed on an \"AS IS\" BASIS,\r\n  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n  See the License for the specific language governing permissions and\r\n  limitations under the License.\r\n*/\r\nvar activeRequireConfig = null;\r\n\r\nexport function loadCss(url) {\r\n  let link = getCss(url);\r\n  if (!link) {\r\n    // create & load the css library\r\n    link = createStylesheetLink(url);\r\n    document.head.appendChild(link);\r\n  }\r\n  return link;\r\n}\r\n\r\nfunction createStylesheetLink(url) {\r\n  const link = document.createElement('link');\r\n  link.rel = 'stylesheet';\r\n  link.href = url;\r\n  return link;\r\n}\r\n\r\n// TODO: export this function?\r\n// check if the css url has been injected or added manually\r\nfunction getCss(url) {\r\n  return document.querySelector(`link[href*=\"${url}\"]`) as HTMLLinkElement;\r\n}\r\n\r\nconst isBrowser = typeof window !== 'undefined';\r\nconst DEFAULT_URL = 'https://js.arcgis.com/4.7/';\r\n// this is the url that is currently being, or already has loaded\r\nlet _currentUrl;\r\n\r\nfunction createScript(url) {\r\n  const script = document.createElement('script');\r\n  script.type = 'text/javascript';\r\n  script.src = url;\r\n  script.setAttribute('data-esri-loader', 'loading');\r\n  return script;\r\n}\r\n\r\n// add a one-time load handler to script\r\n// and optionally add a one time error handler as well\r\nfunction handleScriptLoad(script, callback, errback?) {\r\n  let onScriptError;\r\n  if (errback) {\r\n    // set up an error handler as well\r\n    onScriptError = handleScriptError(script, errback);\r\n  }\r\n  const onScriptLoad = () => {\r\n    // pass the script to the callback\r\n    callback(script);\r\n    // remove this event listener\r\n    script.removeEventListener('load', onScriptLoad, false);\r\n    if (onScriptError) {\r\n      // remove the error listener as well\r\n      script.removeEventListener('error', onScriptError, false);\r\n    }\r\n  };\r\n  script.addEventListener('load', onScriptLoad, false);\r\n}\r\n\r\n// add a one-time error handler to the script\r\nfunction handleScriptError(script, callback) {\r\n  const onScriptError = (e) => {\r\n    // reject the promise and remove this event listener\r\n    callback(e.error || new Error(`There was an error attempting to load ${script.src}`));\r\n    // remove this event listener\r\n    script.removeEventListener('error', onScriptError, false);\r\n  };\r\n  script.addEventListener('error', onScriptError, false);\r\n  return onScriptError;\r\n}\r\n\r\n// interfaces\r\nexport interface ILoadScriptOptions {\r\n  url?: string;\r\n  css?: string;\r\n  requirejsConfig?: { [propName: string]: any };\r\n}\r\n\r\n// allow consuming libraries to provide their own Promise implementations\r\nexport const utils = {\r\n  Promise: isBrowser ? window['Promise'] : undefined\r\n};\r\n\r\n// get the script injected by this library\r\nexport function getScript() {\r\n  return document.querySelector('script[data-esri-loader]') as HTMLScriptElement;\r\n}\r\n// has ArcGIS API been loaded on the page yet?\r\nexport function isLoaded() {\r\n  const globalRequire = window['require'];\r\n  // .on() ensures that it's Dojo's AMD loader\r\n  return globalRequire && window['requirejs'];\r\n}\r\n\r\n// load the ArcGIS API on the page\r\nexport function loadScript(options: ILoadScriptOptions = {}): Promise<HTMLScriptElement> {\r\n  // default options\r\n  if (!options.url) {\r\n    options.url = DEFAULT_URL;\r\n  }\r\n\r\n  return new utils.Promise((resolve, reject) => {\r\n    let script = getScript();\r\n    if (script) {\r\n      // the API is already loaded or in the process of loading...\r\n      // NOTE: have to test against scr attribute value, not script.src\r\n      // b/c the latter will return the full url for relative paths\r\n      const src = script.getAttribute('src');\r\n      if (src !== options.url) {\r\n        // potentially trying to load a different version of the API\r\n        reject(new Error(`The ArcGIS API for JavaScript is already loaded (${src}).`));\r\n      } else {\r\n        if (isLoaded()) {\r\n          // the script has already successfully loaded\r\n          resolve(script);\r\n        } else {\r\n          // wait for the script to load and then resolve\r\n          handleScriptLoad(script, resolve, reject);\r\n        }\r\n      }\r\n    } else {\r\n      if (isLoaded()) {\r\n        // the API has been loaded by some other means\r\n        // potentially trying to load a different version of the API\r\n        reject(new Error(`The ArcGIS API for JavaScript is already loaded.`));\r\n      } else {\r\n        // this is the first time attempting to load the API\r\n        if (options.css) {\r\n          // load the css before loading the script\r\n          loadCss(options.css);\r\n        }\r\n        if (options.requirejsConfig) {\r\n          // set dojo configuration parameters before loading the script\r\n          window['require'].config(options.requirejsConfig);\r\n        }\r\n        // create a script object whose source points to the API\r\n        script = createScript(options.url);\r\n        _currentUrl = options.url;\r\n        // once the script is loaded...\r\n        handleScriptLoad(script, () => {\r\n          // update the status of the script\r\n          script.setAttribute('data-esri-loader', 'loaded');\r\n          // return the script\r\n          resolve(script);\r\n        }, reject);\r\n        // load the script\r\n        document.body.appendChild(script);\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n// wrap \r\nfunction requireModules(modules: string[]): Promise<any[]> {\r\n  return new utils.Promise((resolve, reject) => {\r\n      // If something goes wrong loading the esri/dojo scripts, reject with the error.\r\n      if(window[\"activeRequireFunction\"] == null){\r\n          reject(\"esriLoader.setRequireJSConfig() has not been called: \" + \r\n                 \"You MUST call this function before using esriLoader\");\r\n      } else {\r\n          window[\"activeRequireFunction\"]([\"require\"], function(require){\r\n            require(modules, (...args) => {\r\n            // Resolve with the parameters from dojo require as an array.\r\n            resolve(args);\r\n           },\r\n               reject);\r\n            });\r\n        }\r\n  });\r\n}\r\n\r\n// returns a promise that resolves with an array of the required modules\r\n// also will attempt to lazy load the ArcGIS API if it has not already been loaded\r\nexport function loadModules(modules: string[], loadScriptOptions: ILoadScriptOptions = {}): Promise<any[]> {\r\n    /* if (!isLoaded()) {\r\n    // script is not yet loaded\r\n    if (!loadScriptOptions.url && _currentUrl) {\r\n      // alredy in the process of loading, so default to the same url\r\n      loadScriptOptions.url = _currentUrl;\r\n    }\r\n    // attept to load the script then load the modules\r\n    return loadScript(loadScriptOptions).then(() => requireModules(modules));\r\n  } else {*/\r\n    // script is already loaded, just load the modules\r\n    return requireModules(modules);\r\n    //  }\r\n}\r\n\r\nexport function setRequireJSConfig(config){\r\n    console.log(\"Setting requirejs-esri-loader's config:\");\r\n    console.log(config);\r\n    window[\"activeRequireFunction\"] = window[\"require\"].config(config);\r\n}\r\n\r\n// TODO: import/export getCss too?\r\n//export { loadCss } from './utils/css';\r\n\r\n// NOTE: rollup ignores the default export\r\n// and builds the UMD namespace out of named exports\r\n// so this is only needed so that consumers of the ESM build\r\n// can do esriLoader.loadModules(), etc\r\n// TODO: remove this next breaking change?\r\nexport default {\r\n  setRequireJSConfig,\r\n  getScript,\r\n  isLoaded,\r\n  loadModules,\r\n  loadScript,\r\n  loadCss,\r\n  // TODO: export getCss too?\r\n  utils\r\n};\r\n\r\n","var getEsriLoader = require(\"../loaders/get-esri-loader\");\r\nvar config = require(\"config\");\r\nvar esriLoader = getEsriLoader(config);\r\nvar options = config.EsriLoaderOptions;\r\nvar rendererTypesUtil = require(\"./renderer-types-util\");\r\n\r\nvar getColorOrSizeProp = function(rendererOptions){\r\n    return Object.assign({\r\n        layer: rendererOptions.layer,\r\n        field: rendererOptions.fieldName,\r\n        basemap: rendererOptions.basemap,\r\n        classificationMethod: \"quantile\"\r\n        },\r\n        rendererOptions.otherLyrOptions)\r\n}\r\n\r\nvar inferRenderer = function(renderer, rendererOptions, widget){\r\n    return new Promise(function(resolve, reject) {\r\n        esriLoader.loadModules([\"esri/renderers/smartMapping/creators/size\",\r\n                                \"esri/renderers/smartMapping/creators/color\",\r\n                                \"esri/renderers/smartMapping/creators/location\",\r\n                                \"esri/renderers/SimpleRenderer\",\r\n                                \"esri/renderers/UniqueValueRenderer\",\r\n                                \"esri/renderers/ClassBreaksRenderer\",\r\n                                \"esri/renderers/HeatmapRenderer\",\r\n                                \"esri/renderers/DotDensityRenderer\"],\r\n        options).then(([sizeRendererCreator,\r\n                        colorRendererCreator,\r\n                        locationRendererCreator,\r\n                        SimpleRenderer,\r\n                        UniqueValueRenderer,\r\n                        ClassBreaksRenderer,\r\n                        HeatmapRenderer,\r\n                        DotDensityRenderer]) => {\r\n            if(rendererTypesUtil.isClassedSizeRenderer(renderer)){\r\n                console.log(\"Using classedSizeRenderer...\");\r\n                var prop = getColorOrSizeProp(rendererOptions);\r\n                console.log(prop);\r\n                sizeRendererCreator.createClassBreaksRenderer(prop).then((response) => {\r\n                    resolve(response.renderer)\r\n                }).catch((err) => {\r\n                    console.warn(\"Error on creating Class Breaks Renderer\");\r\n                    reject(err);\r\n                });\r\n            } else if(rendererTypesUtil.isClassedColorRenderer(renderer)){\r\n                console.log(\"Using classedColorRenderer...\");\r\n                var prop = getColorOrSizeProp(rendererOptions);\r\n                colorRendererCreator.createClassBreaksRenderer(prop).then((response) => {\r\n                    resolve(response.renderer);\r\n                }).catch((err) => {\r\n                    console.warn(\"Error on creating Color Renderer\");\r\n                    reject(err);\r\n                });\r\n            } else if (rendererTypesUtil.isHeatMapRenderer(renderer)){\r\n                console.log(\"Using heatmap renderer...\");\r\n                resolve(HeatmapRenderer.fromJSON(rendererOptions));\r\n           } else if (rendererTypesUtil.isSimpleRenderer(renderer)){\r\n                console.log(\"Using simpleRenderer...\");\r\n                resolve(SimpleRenderer.fromJSON(rendererOptions));\r\n            } else if (rendererTypesUtil.isUniqueRenderer(renderer)){\r\n                console.log(\"Using uniqueValueRenderer\");\r\n                resolve(UniqueValueRenderer.fromJSON(rendererOptions));\r\n            } else if (rendererTypesUtil.isClassBreaksRenderer(renderer)){\r\n                console.log(\"Using classBreaksRenderer\");\r\n                resolve(ClassBreaksRenderer.fromJSON(rendererOptions));\r\n            } else if (rendererTypesUtil.isDotDensityRenderer(renderer)){\r\n                console.log(\"Using Dot Density Renderer\"); \r\n                resolve(DotDensityRenderer.fromJSON(rendererOptions));\r\n            } else if (rendererTypesUtil.userSpecifiedAutocastRenderer(renderer)){\r\n                console.log(\"Autocasting the renderer\");\r\n                resolve(rendererOptions);\r\n            } else {\r\n                console.warn(\"Could not infer renderer type\");\r\n                reject(\"Renderer of type '\" + renderer + \"' is not supported. \");\r\n            }\r\n        }).catch((err) => {\r\n            console.warn(\"Error on inferring Renderer\");\r\n            reject(err);\r\n        });\r\n    });\r\n}\r\n\r\nmodule.exports = inferRenderer;\r\n","var createDefaultPopup = function (layer) {\r\n    //Pass in the PopupTemplate already loaded so we don't have to use Promises (overkill)\r\n    var fieldInfos = [];\r\n    for(var i in layer.fields){\r\n        var field = layer.fields[i];\r\n        fieldInfos.push({\r\n            \"fieldName\": field.name,\r\n            \"label\": field.alias,\r\n            \"visible\": true\r\n        });\r\n    };\r\n    return { //will autocast as a PopUpTemplate\r\n        title: layer.title,\r\n        content: [{\r\n            type: \"fields\",\r\n            fieldInfos: fieldInfos\r\n        },]\r\n    };\r\n}\r\n\r\nmodule.exports = createDefaultPopup;\r\n","var getEsriLoader = require(\"../loaders/get-esri-loader\");\r\nvar config = require(\"config\");\r\nvar esriLoader = getEsriLoader(config);\r\nvar options = config.EsriLoaderOptions;\r\n\r\nvar getImageOverlayLayerType = function(){\r\n    return new Promise(function(resolve, reject) {\r\n    esriLoader.loadModules([\"esri/layers/GraphicsLayer\",\r\n                            \"esri/views/2d/layers/BaseLayerView2D\",\r\n                            \"esri/geometry/Extent\",\r\n                            \"esri/geometry/SpatialReference\",\r\n                            \"esri/geometry/projection\",\r\n                            \"esri/core/watchUtils\",\r\n                            \"esri/core/Collection\"],\r\n    options).then(([GraphicsLayer,\r\n                    BaseLayerView2D,\r\n                    Extent,\r\n                    SpatialReference,\r\n                    projection,\r\n                    watchUtils,\r\n                    Collection]) => {\r\n        var ImageOverlayLayerView2D = BaseLayerView2D.createSubclass({\r\n            constructor: function(){\r\n                var requestUpdate = () => {\r\n                    this.requestRender();}\r\n                this.watcher = watchUtils.on(\r\n                    this,\r\n                    \"layer._imagesToOverlay\",\r\n                    \"change\",\r\n                    requestUpdate,\r\n                    requestUpdate,\r\n                    requestUpdate);},\r\n\r\n            render: function(renderParameters) {\r\n                var state = renderParameters.state;\r\n                var pixelRatio = state.pixelRatio;\r\n                var width = state.size[0];\r\n                var height = state.size[1];\r\n                var context = renderParameters.context;\r\n\r\n                if (state.rotation !== 0) {\r\n                    context.translate(width * pixelRatio * 0.5, height * pixelRatio * 0.5);\r\n                    context.rotate((state.rotation * Math.PI) / 180);\r\n                    context.translate(- width * pixelRatio * 0.5, -height * pixelRatio * 0.5);}\r\n\r\n                var i;\r\n                for(i=0;i<this.layer._imagesToOverlay.length; i++){\r\n                    var imgToOverlay = this.layer._imagesToOverlay.getItemAt(i);\r\n                    var min = [0,0];\r\n                    min = state.toScreenNoRotation(min, \r\n                                                   imgToOverlay.extent.xmin, \r\n                                                   imgToOverlay.extent.ymax);\r\n                    var max = [0,0];\r\n                    max = state.toScreenNoRotation(max,\r\n                                                   imgToOverlay.extent.xmax,\r\n                                                   imgToOverlay.extent.ymin);\r\n\r\n                    var screenScale = pixelRatio;\r\n                    context.save();\r\n                    context.globalAlpha = imgToOverlay.opacity;\r\n                    context.drawImage(imgToOverlay.imgEl,\r\n                                      min[0], min[1],\r\n                                      (max[0]-min[0]), \r\n                                      (max[1]-min[1]));\r\n                    context.restore();}}});\r\n\r\n        var ImageOverlayLayer = GraphicsLayer.createSubclass({\r\n            constructor: function(){\r\n                this._imagesToOverlay = new Collection();},\r\n\r\n            createLayerView: function(view) {\r\n                if (view.type === \"2d\") {\r\n                    return new ImageOverlayLayerView2D({\r\n                        view: view,\r\n                        layer: this});}},\r\n\r\n            tryRemoveImageOverlays: function(imageOverlaysToRemove){\r\n                var i;\r\n                for(i=0;i<this._imagesToOverlay.length; i++){\r\n                    var existingOverlay = this._imagesToOverlay.getItemAt(i);\r\n                    if(imageOverlaysToRemove.includes(existingOverlay.id)){\r\n                        this._imagesToOverlay.removeAt(i);\r\n                    }\r\n                }\r\n            },\r\n\r\n            tryOverlayImage: function(image){\r\n            return new Promise((resolve, reject) => {\r\n            projection.load().then(() => {\r\n            var randQuery = \"?\" + Math.random().toString(36).substring(2);\r\n            var imageOverlaySrc = image[\"src\"] + randQuery; //Force no browser cache hit\r\n            fetch(imageOverlaySrc).then((resp) => {\r\n                // Check that we can fetch the URL before trying to draw it\r\n                // (CORs errors & network errors are commonplace, this causes\r\n                // errors to bubble up to the widget display screen\r\n                if(!(resp.ok)){\r\n                    class BadHTTPStatusError extends Error {\r\n                        constructor(message){\r\n                            super(message);\r\n                            this.name = \"BadHTTPStatusError\";\r\n                            this.status = resp.status;}}\r\n                    reject(new BadHTTPStatusError(\r\n                    \"Web request to '\" + resp.url + \"' returned status \" +\r\n                    resp.status + \" with message '\" + resp.statusText + \"'.\"));}\r\n                // If we're here, the image can be loaded correctly -- continue\r\n                var imgEl = new Image();\r\n                imgEl.onload = () => {\r\n                    var sr = SpatialReference.fromJSON(\r\n                        image[\"extent\"][\"spatialReference\"]);\r\n                    var extent = Extent.fromJSON(image[\"extent\"])\r\n                    extent = projection.project(extent,\r\n                                                SpatialReference.WebMercator);\r\n                    var opacity = image[\"opacity\"];\r\n                    var id = image[\"id\"];\r\n                    this._imagesToOverlay.add({\r\n                        id: id,\r\n                        imgEl: imgEl,\r\n                        extent: extent,\r\n                        opacity: opacity});}\r\n                imgEl.src = imageOverlaySrc;\r\n            }).catch((err) => {\r\n                reject(err);});\r\n            }).catch((err) => {\r\n                reject(err);})});\r\n            }});\r\n        resolve(ImageOverlayLayer);\r\n    }).catch((err) => {\r\n        reject(err);\r\n    });\r\n    });\r\n}\r\n\r\nmodule.exports = getImageOverlayLayerType;\r\n","\n        var result = require(\"!!../../node_modules/css-loader/index.js!./main.css\");\n\n        if (typeof result === \"string\") {\n            module.exports = result;\n        } else {\n            module.exports = result.toString();\n        }\n    ","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"html, body {\\r\\n    height: 100%;\\r\\n    width: 100%;\\r\\n    margin: 0px;\\r\\n    padding: 0px;\\r\\n}\\r\\n\\r\\ndiv.widget-subarea {\\r\\n    height: 100%;\\r\\n    width:  100%;\\r\\n}\\r\\n\\r\\ndiv.output_area svg {\\r\\n    /* This override fixes the issue where certain types of layers (Polygon\\r\\n     * layers, load layers, etc.) would not draw in Chrome, or partially draw\\r\\n     * in Safari. */\\r\\n     max-width: inherit;\\r\\n}\\r\\n\", \"\"]);\n\n// exports\n","/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\nmodule.exports = function(useSourceMap) {\n\tvar list = [];\n\n\t// return the list of modules as css string\n\tlist.toString = function toString() {\n\t\treturn this.map(function (item) {\n\t\t\tvar content = cssWithMappingToString(item, useSourceMap);\n\t\t\tif(item[2]) {\n\t\t\t\treturn \"@media \" + item[2] + \"{\" + content + \"}\";\n\t\t\t} else {\n\t\t\t\treturn content;\n\t\t\t}\n\t\t}).join(\"\");\n\t};\n\n\t// import a list of modules into the list\n\tlist.i = function(modules, mediaQuery) {\n\t\tif(typeof modules === \"string\")\n\t\t\tmodules = [[null, modules, \"\"]];\n\t\tvar alreadyImportedModules = {};\n\t\tfor(var i = 0; i < this.length; i++) {\n\t\t\tvar id = this[i][0];\n\t\t\tif(typeof id === \"number\")\n\t\t\t\talreadyImportedModules[id] = true;\n\t\t}\n\t\tfor(i = 0; i < modules.length; i++) {\n\t\t\tvar item = modules[i];\n\t\t\t// skip already imported module\n\t\t\t// this implementation is not 100% perfect for weird media query combinations\n\t\t\t//  when a module is imported multiple times with different media queries.\n\t\t\t//  I hope this will never occur (Hey this way we have smaller bundles)\n\t\t\tif(typeof item[0] !== \"number\" || !alreadyImportedModules[item[0]]) {\n\t\t\t\tif(mediaQuery && !item[2]) {\n\t\t\t\t\titem[2] = mediaQuery;\n\t\t\t\t} else if(mediaQuery) {\n\t\t\t\t\titem[2] = \"(\" + item[2] + \") and (\" + mediaQuery + \")\";\n\t\t\t\t}\n\t\t\t\tlist.push(item);\n\t\t\t}\n\t\t}\n\t};\n\treturn list;\n};\n\nfunction cssWithMappingToString(item, useSourceMap) {\n\tvar content = item[1] || '';\n\tvar cssMapping = item[3];\n\tif (!cssMapping) {\n\t\treturn content;\n\t}\n\n\tif (useSourceMap && typeof btoa === 'function') {\n\t\tvar sourceMapping = toComment(cssMapping);\n\t\tvar sourceURLs = cssMapping.sources.map(function (source) {\n\t\t\treturn '/*# sourceURL=' + cssMapping.sourceRoot + source + ' */'\n\t\t});\n\n\t\treturn [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\n\t}\n\n\treturn [content].join('\\n');\n}\n\n// Adapted from convert-source-map (MIT)\nfunction toComment(sourceMap) {\n\t// eslint-disable-next-line no-undef\n\tvar base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\n\tvar data = 'sourceMappingURL=data:application/json;charset=utf-8;base64,' + base64;\n\n\treturn '/*# ' + data + ' */';\n}\n","module.exports = require(\"@lumino/widgets\");","module.exports = require(\"@jupyterlab/apputils\");"],"sourceRoot":""}